<!DOCTYPE html><html class="appearance-auto" lang="zh-Hans"><head><meta charset="UTF-8"><title>线段树专题总结</title><meta name="description" content="ACM/acm/Acm/题解/算法/博客/blog"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="
Photo by Mohsin khan from Pexels  ### 前言
线段树的专题事实上早就已经刷完了，然而一直拖到现在才写题解......
bin巨的线段树专题主要包括以下几个方面：

线段树维护和、区间和、立方和、最大值、最小值
线段树与染色问题
区间合并
扫描线

正文
HDU1166 敌兵布阵
题意是说，现在有N个数，三种操作，这三种操作分别是：

Add i j，表示在第\(i\)个数\(a_i\)上加上\(j\)
Sub i j，表示在第\(i\)个数\(a_i\)上减去\(j\)
Query i j，表示询问区间\([i,j]\)的总和

典型的单点修改区间查询。直接套线段树模板即可。sub操作可以通过add上相反数实现。
代码如下
#include &amp;lt;cstdio&amp;gt;.."><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="-xGeminix-" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">NeoRuTayE's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">线段树专题总结</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3><h3 class="is-inline-block"><a href="/Love">🧸</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3><h3 class="is-inline-block"><a href="/Love">🧸</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-text">正文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0"><span class="toc-text">后记</span></a></li></ol></div><div class="column is-9"><header class="my-4"></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">线段树专题总结</h1><time class="has-text-grey" datetime="2019-08-10T00:40:00.000Z">2019-08-10</time><article class="mt-2 post-content"><p><img src="https://ae01.alicdn.com/kf/H8248ceab1da6430e949cd345061b92c0I.jpg"></p>
<p>Photo by <strong>Mohsin</strong> khan from <strong>Pexels</strong> <span id="more"></span> ### 前言</p>
<p>线段树的专题事实上早就已经刷完了，然而一直拖到现在才写题解......</p>
<p>bin巨的线段树专题主要包括以下几个方面：</p>
<ul>
<li>线段树维护和、区间和、立方和、最大值、最小值</li>
<li>线段树与染色问题</li>
<li>区间合并</li>
<li>扫描线</li>
</ul>
<h3 id="正文">正文</h3>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/HDU-1166">HDU1166 敌兵布阵</a></p>
<p>题意是说，现在有N个数，三种操作，这三种操作分别是：</p>
<ul>
<li>Add i j，表示在第<span class="math inline">\(i\)</span>个数<span class="math inline">\(a_i\)</span>上加上<span class="math inline">\(j\)</span></li>
<li>Sub i j，表示在第<span class="math inline">\(i\)</span>个数<span class="math inline">\(a_i\)</span>上减去<span class="math inline">\(j\)</span></li>
<li>Query i j，表示询问区间<span class="math inline">\([i,j]\)</span>的总和</li>
</ul>
<p>典型的单点修改区间查询。直接套线段树模板即可。sub操作可以通过add上相反数实现。</p>
<p>代码如下</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb1-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb1-14" title="14"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb1-15" title="15"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="dv">50005</span>;</a>
<a class="sourceLine" id="cb1-19" title="19"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb1-20" title="20"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb1-21" title="21"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb1-22" title="22"><span class="dt">int</span> sum[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb1-23" title="23"><span class="dt">int</span> arr[maxn];</a>
<a class="sourceLine" id="cb1-24" title="24"><span class="dt">void</span> push_up(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb1-25" title="25">{</a>
<a class="sourceLine" id="cb1-26" title="26">    sum[rt]=sum[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]+sum[rt&lt;&lt;<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb1-27" title="27">}</a>
<a class="sourceLine" id="cb1-28" title="28"><span class="dt">void</span> build(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb1-29" title="29">{</a>
<a class="sourceLine" id="cb1-30" title="30">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb1-31" title="31">        scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;sum[rt]);</a>
<a class="sourceLine" id="cb1-32" title="32">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb1-33" title="33">    }</a>
<a class="sourceLine" id="cb1-34" title="34">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb1-35" title="35">    build(lson);</a>
<a class="sourceLine" id="cb1-36" title="36">    build(rson);</a>
<a class="sourceLine" id="cb1-37" title="37">    push_up(rt);</a>
<a class="sourceLine" id="cb1-38" title="38">}</a>
<a class="sourceLine" id="cb1-39" title="39"><span class="dt">void</span> update(<span class="dt">int</span> pos,<span class="dt">int</span> todo,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb1-40" title="40">{</a>
<a class="sourceLine" id="cb1-41" title="41">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb1-42" title="42">        sum[rt]+=todo;</a>
<a class="sourceLine" id="cb1-43" title="43">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb1-44" title="44">    }</a>
<a class="sourceLine" id="cb1-45" title="45">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb1-46" title="46">    <span class="cf">if</span>(pos&lt;=mid)</a>
<a class="sourceLine" id="cb1-47" title="47">        update(pos,todo,lson);</a>
<a class="sourceLine" id="cb1-48" title="48">    <span class="cf">else</span></a>
<a class="sourceLine" id="cb1-49" title="49">        update(pos,todo,rson);</a>
<a class="sourceLine" id="cb1-50" title="50">    push_up(rt);</a>
<a class="sourceLine" id="cb1-51" title="51">}</a>
<a class="sourceLine" id="cb1-52" title="52"><span class="dt">int</span> query(<span class="dt">int</span> L,<span class="dt">int</span> R,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb1-53" title="53">{</a>
<a class="sourceLine" id="cb1-54" title="54">    <span class="cf">if</span>(L&lt;=lef&amp;&amp;R&gt;=rig)</a>
<a class="sourceLine" id="cb1-55" title="55">        <span class="cf">return</span> sum[rt];</a>
<a class="sourceLine" id="cb1-56" title="56">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb1-57" title="57">    <span class="dt">int</span> ret=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-58" title="58">    <span class="cf">if</span>(L&lt;=mid)</a>
<a class="sourceLine" id="cb1-59" title="59">        ret+=query(L,R,lson);</a>
<a class="sourceLine" id="cb1-60" title="60">    <span class="cf">if</span>(R&gt;mid)</a>
<a class="sourceLine" id="cb1-61" title="61">        ret+=query(L,R,rson);</a>
<a class="sourceLine" id="cb1-62" title="62">    <span class="cf">return</span> ret;</a>
<a class="sourceLine" id="cb1-63" title="63">}</a>
<a class="sourceLine" id="cb1-64" title="64"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb1-65" title="65">{</a>
<a class="sourceLine" id="cb1-66" title="66">    <span class="dt">int</span> t;</a>
<a class="sourceLine" id="cb1-67" title="67">    <span class="dt">int</span> kase=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-68" title="68">    scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;t);</a>
<a class="sourceLine" id="cb1-69" title="69">    getchar();</a>
<a class="sourceLine" id="cb1-70" title="70">    <span class="cf">while</span>(t--){</a>
<a class="sourceLine" id="cb1-71" title="71">        printf(<span class="st">"Case </span><span class="sc">%d</span><span class="st">:</span><span class="sc">\n</span><span class="st">"</span>,++kase);</a>
<a class="sourceLine" id="cb1-72" title="72">        mst(arr,<span class="dv">0</span>);mst(sum,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb1-73" title="73">        <span class="dt">int</span> n;</a>
<a class="sourceLine" id="cb1-74" title="74">        scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;n);</a>
<a class="sourceLine" id="cb1-75" title="75">        getchar();</a>
<a class="sourceLine" id="cb1-76" title="76"><span class="co">//        for(int i=1;i&lt;=n;i++)</span></a>
<a class="sourceLine" id="cb1-77" title="77"><span class="co">//            scanf("%d",&amp;arr[i]);</span></a>
<a class="sourceLine" id="cb1-78" title="78">        build(<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb1-79" title="79">        getchar();</a>
<a class="sourceLine" id="cb1-80" title="80">        <span class="cf">while</span>(<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb1-81" title="81">            <span class="dt">char</span> str[<span class="dv">15</span>];<span class="dt">int</span> a,b;</a>
<a class="sourceLine" id="cb1-82" title="82">            scanf(<span class="st">"</span><span class="sc">%s</span><span class="st">"</span>,str);</a>
<a class="sourceLine" id="cb1-83" title="83">            getchar();</a>
<a class="sourceLine" id="cb1-84" title="84">            <span class="cf">if</span>(str[<span class="dv">0</span>]==<span class="ch">'E'</span>)        <span class="cf">break</span>;</a>
<a class="sourceLine" id="cb1-85" title="85">            scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;a,&amp;b); </a>
<a class="sourceLine" id="cb1-86" title="86">            getchar();</a>
<a class="sourceLine" id="cb1-87" title="87">            <span class="cf">if</span>(str[<span class="dv">0</span>]==<span class="ch">'Q'</span>){</a>
<a class="sourceLine" id="cb1-88" title="88">                <span class="dt">int</span> ans=query(a,b,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb1-89" title="89">                printf(<span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span>,ans);</a>
<a class="sourceLine" id="cb1-90" title="90">            }<span class="cf">else</span> <span class="cf">if</span>(str[<span class="dv">0</span>]==<span class="ch">'A'</span>){</a>
<a class="sourceLine" id="cb1-91" title="91">                update(a,b,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb1-92" title="92">            }<span class="cf">else</span> <span class="cf">if</span>(str[<span class="dv">0</span>]==<span class="ch">'S'</span>){</a>
<a class="sourceLine" id="cb1-93" title="93">                update(a,-b,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb1-94" title="94">            }</a>
<a class="sourceLine" id="cb1-95" title="95">        }</a>
<a class="sourceLine" id="cb1-96" title="96">    }</a>
<a class="sourceLine" id="cb1-97" title="97">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-98" title="98">} </a></code></pre></div>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/HDU-1754">HDU1754 I Hate It</a></p>
<p>题意是查询区间最大值，同时还要有修改操作。线段树维护区间最大值即可。</p>
<p>代码如下</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb2-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="pp">#include </span><span class="im">&lt;utility&gt;</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="pp">#include </span><span class="im">&lt;stack&gt;</span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb2-16" title="16"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb2-17" title="17"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="pp">#define IOS </span><span class="bu">std::</span>ios<span class="bu">::</span>sync_with_stdio(<span class="kw">false</span>)</a>
<a class="sourceLine" id="cb2-21" title="21"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="dv">200000</span>+<span class="dv">5</span>;</a>
<a class="sourceLine" id="cb2-22" title="22"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb2-23" title="23"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb2-24" title="24"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb2-25" title="25"><span class="dt">int</span> maxi[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb2-26" title="26"><span class="dt">void</span> pushup(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb2-27" title="27">{</a>
<a class="sourceLine" id="cb2-28" title="28">    maxi[rt]=max(maxi[rt&lt;&lt;<span class="dv">1</span>],maxi[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]);</a>
<a class="sourceLine" id="cb2-29" title="29">}</a>
<a class="sourceLine" id="cb2-30" title="30"><span class="dt">void</span> build(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb2-31" title="31">{</a>
<a class="sourceLine" id="cb2-32" title="32">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb2-33" title="33">        <span class="dt">int</span> tmp;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;tmp);</a>
<a class="sourceLine" id="cb2-34" title="34">        maxi[rt]=tmp;</a>
<a class="sourceLine" id="cb2-35" title="35">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb2-36" title="36">    }</a>
<a class="sourceLine" id="cb2-37" title="37">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb2-38" title="38">    build(lson);</a>
<a class="sourceLine" id="cb2-39" title="39">    build(rson);</a>
<a class="sourceLine" id="cb2-40" title="40">    pushup(rt);</a>
<a class="sourceLine" id="cb2-41" title="41">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb2-42" title="42">}</a>
<a class="sourceLine" id="cb2-43" title="43"><span class="dt">void</span> update(<span class="dt">int</span> pos,<span class="dt">int</span> val,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb2-44" title="44">{</a>
<a class="sourceLine" id="cb2-45" title="45">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb2-46" title="46">        maxi[rt]=val;</a>
<a class="sourceLine" id="cb2-47" title="47">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb2-48" title="48">    }</a>
<a class="sourceLine" id="cb2-49" title="49">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb2-50" title="50">    <span class="cf">if</span>(pos&lt;=mid)</a>
<a class="sourceLine" id="cb2-51" title="51">        update(pos,val,lson);</a>
<a class="sourceLine" id="cb2-52" title="52">    <span class="cf">else</span></a>
<a class="sourceLine" id="cb2-53" title="53">        update(pos,val,rson);</a>
<a class="sourceLine" id="cb2-54" title="54">    pushup(rt);</a>
<a class="sourceLine" id="cb2-55" title="55">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb2-56" title="56">}</a>
<a class="sourceLine" id="cb2-57" title="57"><span class="dt">int</span> ans;</a>
<a class="sourceLine" id="cb2-58" title="58"><span class="dt">void</span> query(<span class="dt">int</span> L,<span class="dt">int</span> R,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb2-59" title="59">{</a>
<a class="sourceLine" id="cb2-60" title="60">    <span class="cf">if</span>(L&lt;=lef&amp;&amp;rig&lt;=R){</a>
<a class="sourceLine" id="cb2-61" title="61">        ans=max(ans,maxi[rt]);</a>
<a class="sourceLine" id="cb2-62" title="62">        <span class="cf">return</span> ;    </a>
<a class="sourceLine" id="cb2-63" title="63">    }</a>
<a class="sourceLine" id="cb2-64" title="64">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb2-65" title="65">    <span class="cf">if</span>(L&lt;=mid)</a>
<a class="sourceLine" id="cb2-66" title="66">        query(L,R,lson);</a>
<a class="sourceLine" id="cb2-67" title="67">    <span class="cf">if</span>(R&gt;mid)</a>
<a class="sourceLine" id="cb2-68" title="68">        query(L,R,rson);</a>
<a class="sourceLine" id="cb2-69" title="69">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb2-70" title="70">}</a>
<a class="sourceLine" id="cb2-71" title="71"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb2-72" title="72">{</a>
<a class="sourceLine" id="cb2-73" title="73">    <span class="dt">int</span> n,m;</a>
<a class="sourceLine" id="cb2-74" title="74">    <span class="cf">while</span>(scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;n,&amp;m)!=EOF){</a>
<a class="sourceLine" id="cb2-75" title="75">        build(<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb2-76" title="76">        ans=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb2-77" title="77"><span class="co">//        getchar();</span></a>
<a class="sourceLine" id="cb2-78" title="78">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;m;i++){</a>
<a class="sourceLine" id="cb2-79" title="79">            getchar();</a>
<a class="sourceLine" id="cb2-80" title="80">            <span class="dt">char</span> op;scanf(<span class="st">"</span><span class="sc">%c</span><span class="st">"</span>,&amp;op);</a>
<a class="sourceLine" id="cb2-81" title="81">            <span class="dt">int</span> x,y;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;x,&amp;y);</a>
<a class="sourceLine" id="cb2-82" title="82">            <span class="cf">if</span>(op==<span class="ch">'Q'</span>){</a>
<a class="sourceLine" id="cb2-83" title="83">                ans=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb2-84" title="84">                query(x,y,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb2-85" title="85">                printf(<span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span>,ans);</a>
<a class="sourceLine" id="cb2-86" title="86">            }<span class="cf">else</span> <span class="cf">if</span>(op==<span class="ch">'U'</span>){</a>
<a class="sourceLine" id="cb2-87" title="87">                update(x,y,<span class="dv">1</span>,n,<span class="dv">1</span>);    </a>
<a class="sourceLine" id="cb2-88" title="88">            }</a>
<a class="sourceLine" id="cb2-89" title="89">        }</a>
<a class="sourceLine" id="cb2-90" title="90">    }</a>
<a class="sourceLine" id="cb2-91" title="91">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb2-92" title="92">}</a></code></pre></div>
<p>这题有多组样例...OTZ</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/POJ-3468">POJ3468 A Simple Problem with integers</a></p>
<p>题意是说，有一串数字以及两种操作，一是为某一区间上的数都加上某个数，另一个操作是询问区间和。最简单的区间修改区间查询。</p>
<p>代码如下：</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb3-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb3-14" title="14"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb3-15" title="15"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="fl">1e5</span>+<span class="dv">5</span>;</a>
<a class="sourceLine" id="cb3-19" title="19"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb3-20" title="20"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb3-21" title="21"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb3-22" title="22">ll sum[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb3-23" title="23">ll lazy[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb3-24" title="24"><span class="dt">void</span> pushup(ll rt)</a>
<a class="sourceLine" id="cb3-25" title="25">{</a>
<a class="sourceLine" id="cb3-26" title="26">    sum[rt]=sum[rt&lt;&lt;<span class="dv">1</span>]+sum[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb3-27" title="27">}</a>
<a class="sourceLine" id="cb3-28" title="28"><span class="dt">void</span> build(ll lef,ll rig,ll rt)</a>
<a class="sourceLine" id="cb3-29" title="29">{</a>
<a class="sourceLine" id="cb3-30" title="30">    sum[rt]=<span class="dv">0</span>;lazy[rt]=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb3-31" title="31">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb3-32" title="32"><span class="co">//        cin&gt;&gt;sum[rt];</span></a>
<a class="sourceLine" id="cb3-33" title="33">        scanf(<span class="st">"</span><span class="sc">%lld</span><span class="st">"</span>,&amp;sum[rt]);</a>
<a class="sourceLine" id="cb3-34" title="34">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb3-35" title="35">    }</a>
<a class="sourceLine" id="cb3-36" title="36">    ll mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb3-37" title="37">    build(lson);</a>
<a class="sourceLine" id="cb3-38" title="38">    build(rson);</a>
<a class="sourceLine" id="cb3-39" title="39">    pushup(rt);</a>
<a class="sourceLine" id="cb3-40" title="40">}</a>
<a class="sourceLine" id="cb3-41" title="41"><span class="dt">void</span> pushdown(ll rt,ll len)</a>
<a class="sourceLine" id="cb3-42" title="42">{</a>
<a class="sourceLine" id="cb3-43" title="43">    <span class="cf">if</span>(lazy[rt]){</a>
<a class="sourceLine" id="cb3-44" title="44">        lazy[rt&lt;&lt;<span class="dv">1</span>]+=lazy[rt];</a>
<a class="sourceLine" id="cb3-45" title="45">        lazy[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]+=lazy[rt];</a>
<a class="sourceLine" id="cb3-46" title="46">        sum[rt&lt;&lt;<span class="dv">1</span>]+=lazy[rt]*(len-(len&gt;&gt;<span class="dv">1</span>));</a>
<a class="sourceLine" id="cb3-47" title="47">        sum[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]+=lazy[rt]*(len&gt;&gt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb3-48" title="48">        lazy[rt]=<span class="dv">0</span>; </a>
<a class="sourceLine" id="cb3-49" title="49">    }</a>
<a class="sourceLine" id="cb3-50" title="50">}</a>
<a class="sourceLine" id="cb3-51" title="51"><span class="dt">void</span> update(ll toL,ll toR,ll todo,ll lef,ll rig,ll rt)</a>
<a class="sourceLine" id="cb3-52" title="52">{</a>
<a class="sourceLine" id="cb3-53" title="53">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;toR&gt;=rig){</a>
<a class="sourceLine" id="cb3-54" title="54">        lazy[rt]+=todo;</a>
<a class="sourceLine" id="cb3-55" title="55">        sum[rt]+=todo*(rig-lef+<span class="dv">1</span>); </a>
<a class="sourceLine" id="cb3-56" title="56">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb3-57" title="57">    }</a>
<a class="sourceLine" id="cb3-58" title="58">    pushdown(rt,rig-lef+<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb3-59" title="59">    ll mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb3-60" title="60">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb3-61" title="61">        update(toL,toR,todo,lson);</a>
<a class="sourceLine" id="cb3-62" title="62">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb3-63" title="63">        update(toL,toR,todo,rson);</a>
<a class="sourceLine" id="cb3-64" title="64">    pushup(rt);</a>
<a class="sourceLine" id="cb3-65" title="65">}</a>
<a class="sourceLine" id="cb3-66" title="66">ll query(ll toL,ll toR,ll lef,ll rig,ll rt)</a>
<a class="sourceLine" id="cb3-67" title="67">{</a>
<a class="sourceLine" id="cb3-68" title="68">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;toR&gt;=rig){</a>
<a class="sourceLine" id="cb3-69" title="69">        <span class="cf">return</span> sum[rt];</a>
<a class="sourceLine" id="cb3-70" title="70">    }</a>
<a class="sourceLine" id="cb3-71" title="71">    pushdown(rt,rig-lef+<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb3-72" title="72">    ll mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb3-73" title="73">    ll ans=<span class="dv">0</span>; </a>
<a class="sourceLine" id="cb3-74" title="74">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb3-75" title="75">        ans+=query(toL,toR,lson);</a>
<a class="sourceLine" id="cb3-76" title="76">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb3-77" title="77">        ans+=query(toL,toR,rson);</a>
<a class="sourceLine" id="cb3-78" title="78">    <span class="cf">return</span> ans;</a>
<a class="sourceLine" id="cb3-79" title="79">        </a>
<a class="sourceLine" id="cb3-80" title="80">}</a>
<a class="sourceLine" id="cb3-81" title="81"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb3-82" title="82">{</a>
<a class="sourceLine" id="cb3-83" title="83"><span class="co">//    std::ios::sync_with_stdio(false);</span></a>
<a class="sourceLine" id="cb3-84" title="84">    ll n,q;</a>
<a class="sourceLine" id="cb3-85" title="85">    scanf(<span class="st">"</span><span class="sc">%lld</span><span class="st"> </span><span class="sc">%lld</span><span class="st">"</span>,&amp;n,&amp;q);</a>
<a class="sourceLine" id="cb3-86" title="86">    build(<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb3-87" title="87">    <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;q;i++){</a>
<a class="sourceLine" id="cb3-88" title="88">        <span class="dt">char</span> op;cin&gt;&gt;op;</a>
<a class="sourceLine" id="cb3-89" title="89">        <span class="cf">if</span>(op==<span class="ch">'Q'</span>){</a>
<a class="sourceLine" id="cb3-90" title="90">            ll L,R;</a>
<a class="sourceLine" id="cb3-91" title="91">            scanf(<span class="st">"</span><span class="sc">%lld</span><span class="st"> </span><span class="sc">%lld</span><span class="st">"</span>,&amp;L,&amp;R);</a>
<a class="sourceLine" id="cb3-92" title="92">            ll ans=query(L,R,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb3-93" title="93">            printf(<span class="st">"</span><span class="sc">%lld\n</span><span class="st">"</span>,ans);</a>
<a class="sourceLine" id="cb3-94" title="94">        }<span class="cf">else</span> <span class="cf">if</span>(op==<span class="ch">'C'</span>){</a>
<a class="sourceLine" id="cb3-95" title="95">            ll L,R,to;</a>
<a class="sourceLine" id="cb3-96" title="96">            scanf(<span class="st">"</span><span class="sc">%lld</span><span class="st"> </span><span class="sc">%lld</span><span class="st"> </span><span class="sc">%lld</span><span class="st">"</span>,&amp;L,&amp;R,&amp;to);</a>
<a class="sourceLine" id="cb3-97" title="97">            update(L,R,to,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb3-98" title="98">        }</a>
<a class="sourceLine" id="cb3-99" title="99">    }</a>
<a class="sourceLine" id="cb3-100" title="100">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb3-101" title="101">} </a></code></pre></div>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/POJ-2528">POJ2528 Mayor's posters</a></p>
<p>已写题解，不再赘述</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://mimori.coding.me/2019/05/18/POJ2528-Mayor-s-poster/">Mayor's poster</a></p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/HDU-1698">HDU1698 Just a Hook</a></p>
<p>就是区间修改区间查询。</p>
<p>代码如下：</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb4-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb4-14" title="14"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb4-15" title="15"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="fl">1e5</span>+<span class="dv">5</span>;</a>
<a class="sourceLine" id="cb4-19" title="19"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb4-20" title="20"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb4-21" title="21"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb4-22" title="22"><span class="dt">int</span> lazy[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb4-23" title="23"><span class="dt">int</span> sum[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb4-24" title="24"><span class="dt">void</span> pushup(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb4-25" title="25">{</a>
<a class="sourceLine" id="cb4-26" title="26">    sum[rt]=sum[rt&lt;&lt;<span class="dv">1</span>]+sum[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb4-27" title="27">}</a>
<a class="sourceLine" id="cb4-28" title="28"><span class="dt">void</span> pushdown(<span class="dt">int</span> rt,<span class="dt">int</span> len)</a>
<a class="sourceLine" id="cb4-29" title="29">{</a>
<a class="sourceLine" id="cb4-30" title="30">    <span class="cf">if</span>(lazy[rt]!=<span class="dv">0</span>){</a>
<a class="sourceLine" id="cb4-31" title="31">        lazy[rt&lt;&lt;<span class="dv">1</span>]=lazy[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=lazy[rt];</a>
<a class="sourceLine" id="cb4-32" title="32">        sum[rt&lt;&lt;<span class="dv">1</span>]=(len-(len&gt;&gt;<span class="dv">1</span>))*lazy[rt];</a>
<a class="sourceLine" id="cb4-33" title="33">        sum[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=(len&gt;&gt;<span class="dv">1</span>)*lazy[rt];</a>
<a class="sourceLine" id="cb4-34" title="34">        lazy[rt]=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-35" title="35">    }</a>
<a class="sourceLine" id="cb4-36" title="36">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb4-37" title="37">}</a>
<a class="sourceLine" id="cb4-38" title="38"><span class="dt">void</span> build(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb4-39" title="39">{</a>
<a class="sourceLine" id="cb4-40" title="40">    sum[rt]=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-41" title="41">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb4-42" title="42">        sum[rt]=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb4-43" title="43">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb4-44" title="44">    }</a>
<a class="sourceLine" id="cb4-45" title="45">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb4-46" title="46">    build(lson);</a>
<a class="sourceLine" id="cb4-47" title="47">    build(rson);</a>
<a class="sourceLine" id="cb4-48" title="48">    pushup(rt);</a>
<a class="sourceLine" id="cb4-49" title="49">}</a>
<a class="sourceLine" id="cb4-50" title="50"><span class="dt">void</span> update(<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> todo,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb4-51" title="51">{</a>
<a class="sourceLine" id="cb4-52" title="52">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;toR&gt;=rig){</a>
<a class="sourceLine" id="cb4-53" title="53">        lazy[rt]=todo;</a>
<a class="sourceLine" id="cb4-54" title="54">        sum[rt]=(rig-lef+<span class="dv">1</span>)*todo;</a>
<a class="sourceLine" id="cb4-55" title="55">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb4-56" title="56">    }</a>
<a class="sourceLine" id="cb4-57" title="57">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb4-58" title="58">    pushdown(rt,rig-lef+<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb4-59" title="59">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb4-60" title="60">        update(toL,toR,todo,lson);</a>
<a class="sourceLine" id="cb4-61" title="61">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb4-62" title="62">        update(toL,toR,todo,rson);</a>
<a class="sourceLine" id="cb4-63" title="63">    pushup(rt);</a>
<a class="sourceLine" id="cb4-64" title="64">}</a>
<a class="sourceLine" id="cb4-65" title="65"><span class="dt">int</span> query(<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb4-66" title="66">{</a>
<a class="sourceLine" id="cb4-67" title="67">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;toR&gt;=rig){</a>
<a class="sourceLine" id="cb4-68" title="68">        <span class="cf">return</span> sum[rt];</a>
<a class="sourceLine" id="cb4-69" title="69">    }</a>
<a class="sourceLine" id="cb4-70" title="70">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb4-71" title="71">    pushdown(rt,rig-lef+<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb4-72" title="72">    <span class="dt">int</span> ret=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-73" title="73">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb4-74" title="74">        ret+=query(toL,toR,lson);</a>
<a class="sourceLine" id="cb4-75" title="75">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb4-76" title="76">        ret+=query(toL,toR,rson);</a>
<a class="sourceLine" id="cb4-77" title="77">    <span class="cf">return</span> ret; </a>
<a class="sourceLine" id="cb4-78" title="78">}</a>
<a class="sourceLine" id="cb4-79" title="79"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb4-80" title="80">{</a>
<a class="sourceLine" id="cb4-81" title="81"><span class="co">//    std::ios::sync_with_stdio(false);</span></a>
<a class="sourceLine" id="cb4-82" title="82">    <span class="dt">int</span> t;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;t);</a>
<a class="sourceLine" id="cb4-83" title="83">    <span class="dt">int</span> kase=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-84" title="84">    <span class="cf">while</span>(t--){</a>
<a class="sourceLine" id="cb4-85" title="85">        mst(lazy,<span class="dv">0</span>);mst(sum,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb4-86" title="86">        <span class="dt">int</span> n;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;n);</a>
<a class="sourceLine" id="cb4-87" title="87">        build(<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb4-88" title="88"><span class="co">//        debug;</span></a>
<a class="sourceLine" id="cb4-89" title="89">        <span class="dt">int</span> q;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;q);</a>
<a class="sourceLine" id="cb4-90" title="90"><span class="co">//        debug;</span></a>
<a class="sourceLine" id="cb4-91" title="91">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;q;i++){</a>
<a class="sourceLine" id="cb4-92" title="92"><span class="co">//            debug;</span></a>
<a class="sourceLine" id="cb4-93" title="93">            <span class="dt">int</span> x,y,z;</a>
<a class="sourceLine" id="cb4-94" title="94">            scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;x,&amp;y,&amp;z);</a>
<a class="sourceLine" id="cb4-95" title="95">            update(x,y,z,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb4-96" title="96">        }</a>
<a class="sourceLine" id="cb4-97" title="97">        <span class="dt">int</span> ans=query(<span class="dv">1</span>,n,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb4-98" title="98">        printf(<span class="st">"Case </span><span class="sc">%d</span><span class="st">: The total value of the hook is </span><span class="sc">%d</span><span class="st">.</span><span class="sc">\n</span><span class="st">"</span>,++kase,ans);</a>
<a class="sourceLine" id="cb4-99" title="99">    }</a>
<a class="sourceLine" id="cb4-100" title="100">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-101" title="101">}</a></code></pre></div>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/ZOJ-1610">ZOJ1610 Count the Colors</a></p>
<p>依然是染色问题。题意是说，在一条直线上涂色，颜色与颜色之间可以相互覆盖，问最终可以看到的颜色有多少。</p>
<p>与贴海报那题思路几乎一样。只需要用个<span class="math inline">\(cnt[]\)</span>数组记录一下颜色个数即可。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb5-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb5-14" title="14"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb5-15" title="15"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb5-18" title="18"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="dv">8005</span>;</a>
<a class="sourceLine" id="cb5-19" title="19"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb5-20" title="20"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb5-21" title="21"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb5-22" title="22"><span class="dt">int</span> lazy[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb5-23" title="23"><span class="dt">int</span> cnt[maxn];</a>
<a class="sourceLine" id="cb5-24" title="24"><span class="kw">struct</span> node{</a>
<a class="sourceLine" id="cb5-25" title="25">    <span class="dt">int</span> lef;</a>
<a class="sourceLine" id="cb5-26" title="26">    <span class="dt">int</span> rig;</a>
<a class="sourceLine" id="cb5-27" title="27">    <span class="dt">int</span> to;</a>
<a class="sourceLine" id="cb5-28" title="28">};</a>
<a class="sourceLine" id="cb5-29" title="29">node ns[<span class="dv">8005</span>];</a>
<a class="sourceLine" id="cb5-30" title="30"><span class="dt">void</span> pushdown(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb5-31" title="31">{</a>
<a class="sourceLine" id="cb5-32" title="32">    <span class="cf">if</span>(lazy[rt]!=-<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb5-33" title="33">        lazy[rt&lt;&lt;<span class="dv">1</span>]=lazy[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=lazy[rt];</a>
<a class="sourceLine" id="cb5-34" title="34">        lazy[rt]=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb5-35" title="35">    }</a>
<a class="sourceLine" id="cb5-36" title="36">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb5-37" title="37">}</a>
<a class="sourceLine" id="cb5-38" title="38"><span class="dt">void</span> update(<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> todo,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb5-39" title="39">{</a>
<a class="sourceLine" id="cb5-40" title="40">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;toR&gt;=rig){</a>
<a class="sourceLine" id="cb5-41" title="41">        lazy[rt]=todo;</a>
<a class="sourceLine" id="cb5-42" title="42">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb5-43" title="43">    }</a>
<a class="sourceLine" id="cb5-44" title="44">    pushdown(rt);</a>
<a class="sourceLine" id="cb5-45" title="45">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb5-46" title="46">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb5-47" title="47">        update(toL,toR,todo,lson);</a>
<a class="sourceLine" id="cb5-48" title="48">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb5-49" title="49">        update(toL,toR,todo,rson);</a>
<a class="sourceLine" id="cb5-50" title="50">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb5-51" title="51">}</a>
<a class="sourceLine" id="cb5-52" title="52"><span class="dt">int</span> tag=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb5-53" title="53"><span class="dt">void</span> query(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb5-54" title="54">{</a>
<a class="sourceLine" id="cb5-55" title="55">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb5-56" title="56">        <span class="cf">if</span>(lazy[rt]!=-<span class="dv">1</span>&amp;&amp;lazy[rt]!=tag){</a>
<a class="sourceLine" id="cb5-57" title="57">            cnt[lazy[rt]]++;</a>
<a class="sourceLine" id="cb5-58" title="58">        }</a>
<a class="sourceLine" id="cb5-59" title="59">        tag=lazy[rt];</a>
<a class="sourceLine" id="cb5-60" title="60">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb5-61" title="61">    }</a>
<a class="sourceLine" id="cb5-62" title="62">    pushdown(rt);</a>
<a class="sourceLine" id="cb5-63" title="63">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb5-64" title="64">    query(lson);</a>
<a class="sourceLine" id="cb5-65" title="65">    query(rson);</a>
<a class="sourceLine" id="cb5-66" title="66">}</a>
<a class="sourceLine" id="cb5-67" title="67"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb5-68" title="68">{</a>
<a class="sourceLine" id="cb5-69" title="69">    <span class="dt">int</span> n;</a>
<a class="sourceLine" id="cb5-70" title="70">    <span class="cf">while</span>(scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;n)!=EOF)</a>
<a class="sourceLine" id="cb5-71" title="71">    {</a>
<a class="sourceLine" id="cb5-72" title="72">        <span class="dt">int</span> max_id=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb5-73" title="73">        <span class="dt">int</span> range=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb5-74" title="74">        mst(lazy,-<span class="dv">1</span>);mst(cnt,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb5-75" title="75">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n;i++){</a>
<a class="sourceLine" id="cb5-76" title="76">            <span class="dt">int</span> lef,rig,to;</a>
<a class="sourceLine" id="cb5-77" title="77">            scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;ns[i].lef,&amp;ns[i].rig,&amp;ns[i].to);</a>
<a class="sourceLine" id="cb5-78" title="78">            range=max(range,ns[i].rig); </a>
<a class="sourceLine" id="cb5-79" title="79">            max_id=max(max_id,ns[i].to);</a>
<a class="sourceLine" id="cb5-80" title="80">        } </a>
<a class="sourceLine" id="cb5-81" title="81">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n;i++)</a>
<a class="sourceLine" id="cb5-82" title="82">            update(ns[i].lef+<span class="dv">1</span>,ns[i].rig,ns[i].to,<span class="dv">0</span>,range,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb5-83" title="83">        query(<span class="dv">0</span>,range,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb5-84" title="84">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;=max_id;i++)</a>
<a class="sourceLine" id="cb5-85" title="85">            <span class="cf">if</span>(cnt[i]!=<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb5-86" title="86">                printf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span>,i,cnt[i]);</a>
<a class="sourceLine" id="cb5-87" title="87">        printf(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>);</a>
<a class="sourceLine" id="cb5-88" title="88">    }</a>
<a class="sourceLine" id="cb5-89" title="89">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb5-90" title="90">}</a></code></pre></div>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/POJ-3264">POJ3264 Balanced Lineup</a></p>
<p>线段树维护区间最大值和最小值</p>
<p>代码如下</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb6-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb6-14" title="14"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb6-15" title="15"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="dv">8005</span>;</a>
<a class="sourceLine" id="cb6-19" title="19"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb6-20" title="20"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb6-21" title="21"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb6-22" title="22"><span class="dt">int</span> lazy[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb6-23" title="23"><span class="dt">int</span> cnt[maxn];</a>
<a class="sourceLine" id="cb6-24" title="24"><span class="kw">struct</span> node{</a>
<a class="sourceLine" id="cb6-25" title="25">    <span class="dt">int</span> lef;</a>
<a class="sourceLine" id="cb6-26" title="26">    <span class="dt">int</span> rig;</a>
<a class="sourceLine" id="cb6-27" title="27">    <span class="dt">int</span> to;</a>
<a class="sourceLine" id="cb6-28" title="28">};</a>
<a class="sourceLine" id="cb6-29" title="29">node ns[<span class="dv">8005</span>];</a>
<a class="sourceLine" id="cb6-30" title="30"><span class="dt">void</span> pushdown(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb6-31" title="31">{</a>
<a class="sourceLine" id="cb6-32" title="32">    <span class="cf">if</span>(lazy[rt]!=-<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb6-33" title="33">        lazy[rt&lt;&lt;<span class="dv">1</span>]=lazy[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=lazy[rt];</a>
<a class="sourceLine" id="cb6-34" title="34">        lazy[rt]=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb6-35" title="35">    }</a>
<a class="sourceLine" id="cb6-36" title="36">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb6-37" title="37">}</a>
<a class="sourceLine" id="cb6-38" title="38"><span class="dt">void</span> update(<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> todo,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb6-39" title="39">{</a>
<a class="sourceLine" id="cb6-40" title="40">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;toR&gt;=rig){</a>
<a class="sourceLine" id="cb6-41" title="41">        lazy[rt]=todo;</a>
<a class="sourceLine" id="cb6-42" title="42">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb6-43" title="43">    }</a>
<a class="sourceLine" id="cb6-44" title="44">    pushdown(rt);</a>
<a class="sourceLine" id="cb6-45" title="45">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb6-46" title="46">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb6-47" title="47">        update(toL,toR,todo,lson);</a>
<a class="sourceLine" id="cb6-48" title="48">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb6-49" title="49">        update(toL,toR,todo,rson);</a>
<a class="sourceLine" id="cb6-50" title="50">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb6-51" title="51">}</a>
<a class="sourceLine" id="cb6-52" title="52"><span class="dt">int</span> tag=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb6-53" title="53"><span class="dt">void</span> query(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb6-54" title="54">{</a>
<a class="sourceLine" id="cb6-55" title="55">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb6-56" title="56">        <span class="cf">if</span>(lazy[rt]!=-<span class="dv">1</span>&amp;&amp;lazy[rt]!=tag){</a>
<a class="sourceLine" id="cb6-57" title="57">            cnt[lazy[rt]]++;</a>
<a class="sourceLine" id="cb6-58" title="58">        }</a>
<a class="sourceLine" id="cb6-59" title="59">        tag=lazy[rt];</a>
<a class="sourceLine" id="cb6-60" title="60">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb6-61" title="61">    }</a>
<a class="sourceLine" id="cb6-62" title="62">    pushdown(rt);</a>
<a class="sourceLine" id="cb6-63" title="63">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb6-64" title="64">    query(lson);</a>
<a class="sourceLine" id="cb6-65" title="65">    query(rson);</a>
<a class="sourceLine" id="cb6-66" title="66">}</a>
<a class="sourceLine" id="cb6-67" title="67"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb6-68" title="68">{</a>
<a class="sourceLine" id="cb6-69" title="69">    <span class="dt">int</span> n;</a>
<a class="sourceLine" id="cb6-70" title="70">    <span class="cf">while</span>(scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;n)!=EOF)</a>
<a class="sourceLine" id="cb6-71" title="71">    {</a>
<a class="sourceLine" id="cb6-72" title="72">        <span class="dt">int</span> max_id=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb6-73" title="73">        <span class="dt">int</span> range=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb6-74" title="74">        mst(lazy,-<span class="dv">1</span>);mst(cnt,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb6-75" title="75">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n;i++){</a>
<a class="sourceLine" id="cb6-76" title="76">            <span class="dt">int</span> lef,rig,to;</a>
<a class="sourceLine" id="cb6-77" title="77">            scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;ns[i].lef,&amp;ns[i].rig,&amp;ns[i].to);</a>
<a class="sourceLine" id="cb6-78" title="78">            range=max(range,ns[i].rig); </a>
<a class="sourceLine" id="cb6-79" title="79">            max_id=max(max_id,ns[i].to);</a>
<a class="sourceLine" id="cb6-80" title="80">        } </a>
<a class="sourceLine" id="cb6-81" title="81">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n;i++)</a>
<a class="sourceLine" id="cb6-82" title="82">            update(ns[i].lef+<span class="dv">1</span>,ns[i].rig,ns[i].to,<span class="dv">0</span>,range,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb6-83" title="83">        query(<span class="dv">0</span>,range,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb6-84" title="84">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;=max_id;i++)</a>
<a class="sourceLine" id="cb6-85" title="85">            <span class="cf">if</span>(cnt[i]!=<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb6-86" title="86">                printf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span>,i,cnt[i]);</a>
<a class="sourceLine" id="cb6-87" title="87">        printf(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>);</a>
<a class="sourceLine" id="cb6-88" title="88">    }</a>
<a class="sourceLine" id="cb6-89" title="89">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb6-90" title="90">}</a></code></pre></div>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/HDU-4027">HDU4027 Can you answer these queries?</a></p>
<p>题意是说，现在有一正整数序列，还有两种操作，第一种是可以将某一区间内的整数变为其自身的平方根；第二种操作是询问区间和。</p>
<p>注意本题有一个条件，“Notice that the square root operation should be rounded down to integer.”，因此，当某次操作后，如果某个数的结果小于1，那它就直接变成0了！这就给了我们一个解题的思路：这题我们可以一直走到叶子节点再进行平方根操作，对于那些已经为0的数，就可以将它们记录下来，下次操作的时候就可以不用操作这个数了！由此降低复杂度。</p>
<p>代码如下：</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb7-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb7-14" title="14"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb7-15" title="15"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="dv">100000</span>+<span class="dv">10</span>;</a>
<a class="sourceLine" id="cb7-19" title="19"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb7-20" title="20"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb7-21" title="21"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb7-22" title="22">ll sum[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb7-23" title="23"><span class="dt">bool</span> flag[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb7-24" title="24"><span class="dt">void</span> pushup(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb7-25" title="25">{</a>
<a class="sourceLine" id="cb7-26" title="26">    sum[rt]=sum[rt&lt;&lt;<span class="dv">1</span>]+sum[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb7-27" title="27">    flag[rt]=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb7-28" title="28">    <span class="cf">if</span>(flag[rt&lt;&lt;<span class="dv">1</span>]&amp;&amp;flag[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb7-29" title="29">        flag[rt]=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb7-30" title="30">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb7-31" title="31">}</a>
<a class="sourceLine" id="cb7-32" title="32"><span class="dt">void</span> build(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb7-33" title="33">{</a>
<a class="sourceLine" id="cb7-34" title="34">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb7-35" title="35">        scanf(<span class="st">"</span><span class="sc">%lld</span><span class="st">"</span>,&amp;sum[rt]);</a>
<a class="sourceLine" id="cb7-36" title="36">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb7-37" title="37">    }</a>
<a class="sourceLine" id="cb7-38" title="38">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb7-39" title="39">    build(lson);</a>
<a class="sourceLine" id="cb7-40" title="40">    build(rson);</a>
<a class="sourceLine" id="cb7-41" title="41">    pushup(rt);</a>
<a class="sourceLine" id="cb7-42" title="42">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb7-43" title="43">}</a>
<a class="sourceLine" id="cb7-44" title="44"><span class="dt">void</span> update(<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb7-45" title="45">{</a>
<a class="sourceLine" id="cb7-46" title="46">    <span class="cf">if</span>(flag[rt])</a>
<a class="sourceLine" id="cb7-47" title="47">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb7-48" title="48">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb7-49" title="49">        sum[rt]=(ll)sqrt(sum[rt]);</a>
<a class="sourceLine" id="cb7-50" title="50">        <span class="cf">if</span>(sum[rt]&lt;=<span class="dv">1</span>)        </a>
<a class="sourceLine" id="cb7-51" title="51">            flag[rt]=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb7-52" title="52">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb7-53" title="53">    }</a>
<a class="sourceLine" id="cb7-54" title="54">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb7-55" title="55">    <span class="cf">if</span>(toL&lt;=mid) </a>
<a class="sourceLine" id="cb7-56" title="56">        update(toL,toR,lson);</a>
<a class="sourceLine" id="cb7-57" title="57">    <span class="cf">if</span>(toR&gt;mid)    </a>
<a class="sourceLine" id="cb7-58" title="58">        update(toL,toR,rson);</a>
<a class="sourceLine" id="cb7-59" title="59">    pushup(rt);</a>
<a class="sourceLine" id="cb7-60" title="60">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb7-61" title="61">}</a>
<a class="sourceLine" id="cb7-62" title="62">ll ans=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb7-63" title="63"><span class="dt">void</span> query(<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb7-64" title="64">{</a>
<a class="sourceLine" id="cb7-65" title="65">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;rig&lt;=toR){</a>
<a class="sourceLine" id="cb7-66" title="66">        ans+=sum[rt];</a>
<a class="sourceLine" id="cb7-67" title="67">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb7-68" title="68">    }</a>
<a class="sourceLine" id="cb7-69" title="69">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb7-70" title="70">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb7-71" title="71">        query(toL,toR,lson);</a>
<a class="sourceLine" id="cb7-72" title="72">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb7-73" title="73">        query(toL,toR,rson);</a>
<a class="sourceLine" id="cb7-74" title="74">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb7-75" title="75">}</a>
<a class="sourceLine" id="cb7-76" title="76"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb7-77" title="77">{</a>
<a class="sourceLine" id="cb7-78" title="78">    <span class="dt">int</span> n;<span class="dt">int</span> kase=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb7-79" title="79">    <span class="cf">while</span>(scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;n)!=EOF){</a>
<a class="sourceLine" id="cb7-80" title="80">        mst(flag,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb7-81" title="81">        build(<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb7-82" title="82">        <span class="dt">int</span> t;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;t);</a>
<a class="sourceLine" id="cb7-83" title="83">        printf(<span class="st">"Case #</span><span class="sc">%d</span><span class="st">:</span><span class="sc">\n</span><span class="st">"</span>,++kase);</a>
<a class="sourceLine" id="cb7-84" title="84">        <span class="cf">while</span>(t--){</a>
<a class="sourceLine" id="cb7-85" title="85">            <span class="dt">int</span> op,l,r;</a>
<a class="sourceLine" id="cb7-86" title="86">            scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;op,&amp;l,&amp;r);</a>
<a class="sourceLine" id="cb7-87" title="87">            <span class="cf">if</span>(l&gt;r)</a>
<a class="sourceLine" id="cb7-88" title="88">                swap(l,r);</a>
<a class="sourceLine" id="cb7-89" title="89">            <span class="cf">if</span>(op==<span class="dv">0</span>){</a>
<a class="sourceLine" id="cb7-90" title="90">                update(l,r,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb7-91" title="91">            }<span class="cf">else</span> <span class="cf">if</span>(op==<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb7-92" title="92">                ans=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb7-93" title="93">                query(l,r,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb7-94" title="94">                printf(<span class="st">"</span><span class="sc">%lld\n</span><span class="st">"</span>,ans);</a>
<a class="sourceLine" id="cb7-95" title="95">            }</a>
<a class="sourceLine" id="cb7-96" title="96">        }</a>
<a class="sourceLine" id="cb7-97" title="97">        printf(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>);</a>
<a class="sourceLine" id="cb7-98" title="98">    }</a>
<a class="sourceLine" id="cb7-99" title="99">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb7-100" title="100">}</a></code></pre></div>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/HDU-1540">HDU1540 Tunnel Warfare</a></p>
<p>地道战。</p>
<p>题意是说，有一系列的村庄，除了末端的两个村庄以外，其他的都与相邻的两个连接形成一条线。现在有三种操作，一种是摧毁第<span class="math inline">\(x\)</span>个村庄；一种是询问有多少个村庄与第<span class="math inline">\(x\)</span>个村庄直接或间接连接；还有一种是将最后被摧毁的村庄修复，意味着该村庄与其邻近两个村庄的连接重新建立。</p>
<p>这题的正解是区间合并，但有一种很巧妙的做法：用线段树维护区间最大值和最小值。对于最大值，一开始初始化每个村庄都为0；对于最小值，初始化每个村庄都为INF。摧毁的时候，如果要摧毁第<span class="math inline">\(x\)</span>个村庄，只需要将对应的maxi[rt]改为<span class="math inline">\(x\)</span>，对应的mini[rt]也改为<span class="math inline">\(x\)</span>即可。查询的时候，对于第<span class="math inline">\(x\)</span>个村庄，查询区间<span class="math inline">\([1,x-1]\)</span>的最小值<span class="math inline">\(mini\_val\)</span>，再查询区间<span class="math inline">\([x,n]\)</span>的最大值<span class="math inline">\(mini\_val\)</span>，答案就是<span class="math inline">\(mini\_val-maxi\_val-1\)</span>。而对于修复操作，只需要将对应的maxi[rt]改回0，mini[rt]改回INF即可。</p>
<p>代码如下：</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb8-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb8-14" title="14"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb8-15" title="15"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb8-17" title="17"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb8-18" title="18"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="dv">50000</span>+<span class="dv">5</span>;</a>
<a class="sourceLine" id="cb8-19" title="19"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb8-20" title="20"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb8-21" title="21"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb8-22" title="22"><span class="dt">int</span> mini[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb8-23" title="23"><span class="dt">int</span> maxi[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb8-24" title="24"><span class="dt">int</span> n;</a>
<a class="sourceLine" id="cb8-25" title="25"><span class="dt">void</span> pushup(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb8-26" title="26">{</a>
<a class="sourceLine" id="cb8-27" title="27">    mini[rt]=min(mini[rt&lt;&lt;<span class="dv">1</span>],mini[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]);</a>
<a class="sourceLine" id="cb8-28" title="28">    maxi[rt]=max(maxi[rt&lt;&lt;<span class="dv">1</span>],maxi[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]);</a>
<a class="sourceLine" id="cb8-29" title="29">}</a>
<a class="sourceLine" id="cb8-30" title="30"><span class="dt">void</span> build(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb8-31" title="31">{</a>
<a class="sourceLine" id="cb8-32" title="32">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb8-33" title="33">        mini[rt]=n+<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb8-34" title="34">        maxi[rt]=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb8-35" title="35">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb8-36" title="36">    }</a>
<a class="sourceLine" id="cb8-37" title="37">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb8-38" title="38">    build(lson);</a>
<a class="sourceLine" id="cb8-39" title="39">    build(rson);</a>
<a class="sourceLine" id="cb8-40" title="40">    pushup(rt);</a>
<a class="sourceLine" id="cb8-41" title="41">}</a>
<a class="sourceLine" id="cb8-42" title="42"><span class="dt">void</span> update_max(<span class="dt">int</span> pos,<span class="dt">int</span> todo,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb8-43" title="43">{</a>
<a class="sourceLine" id="cb8-44" title="44">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb8-45" title="45">        maxi[rt]=todo;</a>
<a class="sourceLine" id="cb8-46" title="46">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb8-47" title="47">    }</a>
<a class="sourceLine" id="cb8-48" title="48">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb8-49" title="49">    <span class="cf">if</span>(pos&lt;=mid)</a>
<a class="sourceLine" id="cb8-50" title="50">        update_max(pos,todo,lson);</a>
<a class="sourceLine" id="cb8-51" title="51">    <span class="cf">if</span>(pos&gt;mid)</a>
<a class="sourceLine" id="cb8-52" title="52">        update_max(pos,todo,rson);</a>
<a class="sourceLine" id="cb8-53" title="53">    maxi[rt]=max(maxi[rt&lt;&lt;<span class="dv">1</span>],maxi[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]);</a>
<a class="sourceLine" id="cb8-54" title="54">}</a>
<a class="sourceLine" id="cb8-55" title="55"><span class="dt">void</span> update_min(<span class="dt">int</span> pos,<span class="dt">int</span> todo,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb8-56" title="56">{</a>
<a class="sourceLine" id="cb8-57" title="57">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb8-58" title="58">        mini[rt]=todo;</a>
<a class="sourceLine" id="cb8-59" title="59">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb8-60" title="60">    }</a>
<a class="sourceLine" id="cb8-61" title="61">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb8-62" title="62">    <span class="cf">if</span>(pos&lt;=mid)</a>
<a class="sourceLine" id="cb8-63" title="63">        update_min(pos,todo,lson);</a>
<a class="sourceLine" id="cb8-64" title="64">    <span class="cf">if</span>(pos&gt;mid)</a>
<a class="sourceLine" id="cb8-65" title="65">        update_min(pos,todo,rson);</a>
<a class="sourceLine" id="cb8-66" title="66">    mini[rt]=min(mini[rt&lt;&lt;<span class="dv">1</span>],mini[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]);</a>
<a class="sourceLine" id="cb8-67" title="67">}</a>
<a class="sourceLine" id="cb8-68" title="68"><span class="dt">int</span> min_val=INF;</a>
<a class="sourceLine" id="cb8-69" title="69"><span class="dt">int</span> max_val=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb8-70" title="70"><span class="dt">void</span> query_max(<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb8-71" title="71">{</a>
<a class="sourceLine" id="cb8-72" title="72">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;rig&lt;=toR){</a>
<a class="sourceLine" id="cb8-73" title="73">        max_val=max(max_val,maxi[rt]);</a>
<a class="sourceLine" id="cb8-74" title="74">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb8-75" title="75">    }</a>
<a class="sourceLine" id="cb8-76" title="76">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb8-77" title="77">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb8-78" title="78">        query_max(toL,toR,lson);</a>
<a class="sourceLine" id="cb8-79" title="79">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb8-80" title="80">        query_max(toL,toR,rson);</a>
<a class="sourceLine" id="cb8-81" title="81">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb8-82" title="82">}</a>
<a class="sourceLine" id="cb8-83" title="83"><span class="dt">void</span> query_min(<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb8-84" title="84">{</a>
<a class="sourceLine" id="cb8-85" title="85">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;rig&lt;=toR){</a>
<a class="sourceLine" id="cb8-86" title="86">        min_val=min(min_val,mini[rt]);</a>
<a class="sourceLine" id="cb8-87" title="87">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb8-88" title="88">    }</a>
<a class="sourceLine" id="cb8-89" title="89">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb8-90" title="90">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb8-91" title="91">        query_min(toL,toR,lson);</a>
<a class="sourceLine" id="cb8-92" title="92">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb8-93" title="93">        query_min(toL,toR,rson);</a>
<a class="sourceLine" id="cb8-94" title="94">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb8-95" title="95">}</a>
<a class="sourceLine" id="cb8-96" title="96"><span class="dt">int</span> stk[maxn];</a>
<a class="sourceLine" id="cb8-97" title="97"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb8-98" title="98">{</a>
<a class="sourceLine" id="cb8-99" title="99">    <span class="dt">int</span> m;</a>
<a class="sourceLine" id="cb8-100" title="100">     <span class="cf">while</span>(scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;n,&amp;m)!=EOF){</a>
<a class="sourceLine" id="cb8-101" title="101">         getchar();<span class="dt">int</span> cnt=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb8-102" title="102">         mst(stk,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb8-103" title="103">         build(<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb8-104" title="104">         <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;m;i++){</a>
<a class="sourceLine" id="cb8-105" title="105">             max_val=-<span class="dv">2</span>;min_val=INF;</a>
<a class="sourceLine" id="cb8-106" title="106">            <span class="dt">char</span> op;cin&gt;&gt;op;</a>
<a class="sourceLine" id="cb8-107" title="107"><span class="co">//            getchar();getchar();</span></a>
<a class="sourceLine" id="cb8-108" title="108">            <span class="cf">if</span>(op==<span class="ch">'D'</span>){</a>
<a class="sourceLine" id="cb8-109" title="109">                <span class="dt">int</span> a;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;a);</a>
<a class="sourceLine" id="cb8-110" title="110">                stk[cnt++]=a;</a>
<a class="sourceLine" id="cb8-111" title="111">                update_max(a,a,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb8-112" title="112">                update_min(a,a,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb8-113" title="113">            }<span class="cf">else</span> <span class="cf">if</span>(op==<span class="ch">'Q'</span>){</a>
<a class="sourceLine" id="cb8-114" title="114">                <span class="dt">int</span> a;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;a);</a>
<a class="sourceLine" id="cb8-115" title="115">                query_max(<span class="dv">1</span>,a,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb8-116" title="116">                query_min(a,n,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb8-117" title="117"><span class="co">//                cout&lt;&lt;"max:"&lt;&lt;max_val&lt;&lt;" "&lt;&lt;"min:"&lt;&lt;min_val&lt;&lt;endl; </span></a>
<a class="sourceLine" id="cb8-118" title="118"><span class="co">//                if(min_val==50001)        min_val=n+1;</span></a>
<a class="sourceLine" id="cb8-119" title="119"><span class="co">//                if(max_val==-1)        max_val=1;</span></a>
<a class="sourceLine" id="cb8-120" title="120">                <span class="dt">int</span> ans=min_val-max_val-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb8-121" title="121">                <span class="cf">if</span>(min_val==max_val)        ans=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb8-122" title="122">                printf(<span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span>,ans);</a>
<a class="sourceLine" id="cb8-123" title="123">            }<span class="cf">else</span> <span class="cf">if</span>(op==<span class="ch">'R'</span>){</a>
<a class="sourceLine" id="cb8-124" title="124">                <span class="dt">int</span> tmp=stk[--cnt];</a>
<a class="sourceLine" id="cb8-125" title="125">                update_max(tmp,<span class="dv">0</span>,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb8-126" title="126">                update_min(tmp,n+<span class="dv">1</span>,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb8-127" title="127">            }</a>
<a class="sourceLine" id="cb8-128" title="128">        }</a>
<a class="sourceLine" id="cb8-129" title="129">    }</a>
<a class="sourceLine" id="cb8-130" title="130">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb8-131" title="131">}</a></code></pre></div>
<p>然而本题的正解我却没有写hhhh，先挖个坑，到时再补</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/HDU-3974">HDU3974 Assign the task</a></p>
<p>题意是说，一个公司有N个员工，每个员工都有一个直接的上司。叶子节点没有下属，树根没有上司。当上司收到工作后，上司会将这份工作下发给他的所有下属，包括不直属的下属。下属在收到一份新的工作后，会马上停止手头上的工作开始新的工作。问，当前某个员工的工作是什么。</p>
<p>先用dfs序将树转为线性区间，就转化为单点查询区间修改的问题了，可以直接用线段树来搞。</p>
<p>代码如下：</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb9-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb9-14" title="14"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb9-15" title="15"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="dv">50010</span>;</a>
<a class="sourceLine" id="cb9-19" title="19"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb9-20" title="20"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb9-21" title="21"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb9-22" title="22"><span class="dt">int</span> in[maxn];</a>
<a class="sourceLine" id="cb9-23" title="23"><span class="dt">int</span> out[maxn];</a>
<a class="sourceLine" id="cb9-24" title="24">vector&lt;<span class="dt">int</span>&gt; gra[maxn];</a>
<a class="sourceLine" id="cb9-25" title="25"><span class="dt">int</span> tree[maxn&lt;&lt;<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb9-26" title="26"><span class="dt">int</span> len=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb9-27" title="27"><span class="dt">bool</span> vis[maxn];</a>
<a class="sourceLine" id="cb9-28" title="28"><span class="dt">int</span> id=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb9-29" title="29"><span class="dt">void</span> dfs(<span class="dt">int</span> u)        <span class="co">//id从1开始 </span></a>
<a class="sourceLine" id="cb9-30" title="30">{</a>
<a class="sourceLine" id="cb9-31" title="31">    len++;</a>
<a class="sourceLine" id="cb9-32" title="32">    in[u]=id++;        <span class="co">//记录一下入栈时间 </span></a>
<a class="sourceLine" id="cb9-33" title="33">    <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;gra[u].size();i++){</a>
<a class="sourceLine" id="cb9-34" title="34">        dfs(gra[u][i]);</a>
<a class="sourceLine" id="cb9-35" title="35">    }</a>
<a class="sourceLine" id="cb9-36" title="36">    out[u]=id++;    <span class="co">//记录一下出栈时间 </span></a>
<a class="sourceLine" id="cb9-37" title="37">    len++;</a>
<a class="sourceLine" id="cb9-38" title="38">}</a>
<a class="sourceLine" id="cb9-39" title="39"><span class="dt">void</span> build(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb9-40" title="40">{</a>
<a class="sourceLine" id="cb9-41" title="41">    tree[rt]=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb9-42" title="42">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb9-43" title="43">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb9-44" title="44">    }</a>
<a class="sourceLine" id="cb9-45" title="45">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb9-46" title="46">    build(lson);</a>
<a class="sourceLine" id="cb9-47" title="47">    build(rson);</a>
<a class="sourceLine" id="cb9-48" title="48">}</a>
<a class="sourceLine" id="cb9-49" title="49"><span class="dt">void</span> pushdown(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb9-50" title="50">{</a>
<a class="sourceLine" id="cb9-51" title="51">    <span class="cf">if</span>(tree[rt]!=-<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb9-52" title="52">        tree[rt&lt;&lt;<span class="dv">1</span>]=tree[rt];</a>
<a class="sourceLine" id="cb9-53" title="53">        tree[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=tree[rt];</a>
<a class="sourceLine" id="cb9-54" title="54">        tree[rt]=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb9-55" title="55">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb9-56" title="56">    }</a>
<a class="sourceLine" id="cb9-57" title="57">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb9-58" title="58">}</a>
<a class="sourceLine" id="cb9-59" title="59"><span class="dt">void</span> update(<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> todo,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb9-60" title="60">{</a>
<a class="sourceLine" id="cb9-61" title="61">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;rig&lt;=toR){</a>
<a class="sourceLine" id="cb9-62" title="62">        tree[rt]=todo;</a>
<a class="sourceLine" id="cb9-63" title="63">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb9-64" title="64">    }</a>
<a class="sourceLine" id="cb9-65" title="65">    pushdown(rt);</a>
<a class="sourceLine" id="cb9-66" title="66">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb9-67" title="67">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb9-68" title="68">        update(toL,toR,todo,lson);</a>
<a class="sourceLine" id="cb9-69" title="69">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb9-70" title="70">        update(toL,toR,todo,rson);</a>
<a class="sourceLine" id="cb9-71" title="71">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb9-72" title="72">}</a>
<a class="sourceLine" id="cb9-73" title="73"><span class="dt">int</span> ans;</a>
<a class="sourceLine" id="cb9-74" title="74"><span class="dt">void</span> query(<span class="dt">int</span> pos,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb9-75" title="75">{</a>
<a class="sourceLine" id="cb9-76" title="76">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb9-77" title="77">        ans=tree[rt];</a>
<a class="sourceLine" id="cb9-78" title="78">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb9-79" title="79">    }</a>
<a class="sourceLine" id="cb9-80" title="80">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb9-81" title="81">    pushdown(rt);</a>
<a class="sourceLine" id="cb9-82" title="82">    <span class="cf">if</span>(pos&lt;=mid)</a>
<a class="sourceLine" id="cb9-83" title="83">        query(pos,lson);</a>
<a class="sourceLine" id="cb9-84" title="84">    <span class="cf">if</span>(pos&gt;mid)</a>
<a class="sourceLine" id="cb9-85" title="85">        query(pos,rson);</a>
<a class="sourceLine" id="cb9-86" title="86">    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb9-87" title="87">}</a>
<a class="sourceLine" id="cb9-88" title="88"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb9-89" title="89">{</a>
<a class="sourceLine" id="cb9-90" title="90"><span class="co">//    freopen("data_generator.txt","r",stdin);</span></a>
<a class="sourceLine" id="cb9-91" title="91">    <span class="dt">int</span> t;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;t);</a>
<a class="sourceLine" id="cb9-92" title="92">    <span class="dt">int</span> kase=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb9-93" title="93">    <span class="cf">while</span>(t--){</a>
<a class="sourceLine" id="cb9-94" title="94">        printf(<span class="st">"Case #</span><span class="sc">%d</span><span class="st">:</span><span class="sc">\n</span><span class="st">"</span>,++kase);</a>
<a class="sourceLine" id="cb9-95" title="95">        ans=<span class="dv">0</span>;id=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb9-96" title="96">        mst(vis,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb9-97" title="97">        mst(in,<span class="dv">0</span>);mst(out,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb9-98" title="98">        <span class="dt">int</span> n;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;n);</a>
<a class="sourceLine" id="cb9-99" title="99">        build(<span class="dv">1</span>,<span class="dv">2</span>*n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb9-100" title="100">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n-<span class="dv">1</span>;i++){</a>
<a class="sourceLine" id="cb9-101" title="101">            <span class="dt">int</span> u,v;</a>
<a class="sourceLine" id="cb9-102" title="102">            scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;u,&amp;v);</a>
<a class="sourceLine" id="cb9-103" title="103">            gra[v].push_back(u);</a>
<a class="sourceLine" id="cb9-104" title="104">            vis[u]=<span class="dv">1</span>;        <span class="co">//用来记录节点u是否是别人的儿子 </span></a>
<a class="sourceLine" id="cb9-105" title="105">        }</a>
<a class="sourceLine" id="cb9-106" title="106">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">1</span>;i&lt;=n;i++){</a>
<a class="sourceLine" id="cb9-107" title="107">            <span class="cf">if</span>(!vis[i]){</a>
<a class="sourceLine" id="cb9-108" title="108">                dfs(i);</a>
<a class="sourceLine" id="cb9-109" title="109">                <span class="cf">break</span>;</a>
<a class="sourceLine" id="cb9-110" title="110">            }</a>
<a class="sourceLine" id="cb9-111" title="111">        }</a>
<a class="sourceLine" id="cb9-112" title="112">        <span class="dt">int</span> m;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;m);</a>
<a class="sourceLine" id="cb9-113" title="113"><span class="co">//        getchar();</span></a>
<a class="sourceLine" id="cb9-114" title="114">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;m;i++){</a>
<a class="sourceLine" id="cb9-115" title="115">            <span class="dt">char</span> op;cin&gt;&gt;op;</a>
<a class="sourceLine" id="cb9-116" title="116"><span class="co">//            char tmp=getchar();</span></a>
<a class="sourceLine" id="cb9-117" title="117">            <span class="cf">if</span>(op==<span class="ch">'C'</span>){</a>
<a class="sourceLine" id="cb9-118" title="118">                <span class="dt">int</span> x;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;x);</a>
<a class="sourceLine" id="cb9-119" title="119">                query(in[x],<span class="dv">1</span>,<span class="dv">2</span>*n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb9-120" title="120">                printf(<span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span>,ans);    </a>
<a class="sourceLine" id="cb9-121" title="121">            }<span class="cf">else</span> <span class="cf">if</span>(op==<span class="ch">'T'</span>){</a>
<a class="sourceLine" id="cb9-122" title="122">                <span class="dt">int</span> x,y;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;x,&amp;y);</a>
<a class="sourceLine" id="cb9-123" title="123">                update(in[x],out[x],y,<span class="dv">1</span>,<span class="dv">2</span>*n,<span class="dv">1</span>);    </a>
<a class="sourceLine" id="cb9-124" title="124">            }</a>
<a class="sourceLine" id="cb9-125" title="125">        }</a>
<a class="sourceLine" id="cb9-126" title="126">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">1</span>;i&lt;=n;i++)</a>
<a class="sourceLine" id="cb9-127" title="127">            gra[i].clear();</a>
<a class="sourceLine" id="cb9-128" title="128">    }</a>
<a class="sourceLine" id="cb9-129" title="129">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb9-130" title="130">}</a></code></pre></div>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/HDU-4578">HDU4578 Transformation</a></p>
<p>题意是说，现在有<span class="math inline">\(n\)</span>个整数<span class="math inline">\(a_1,a_2,a_3,...,a_n\)</span>，初始值都为0。有以下四种操作：</p>
<ul>
<li><p>对<span class="math inline">\(a_x\)</span>到<span class="math inline">\(a_y\)</span>的数，分别都加上<span class="math inline">\(c\)</span>。</p></li>
<li><p>对<span class="math inline">\(a_x\)</span>到<span class="math inline">\(a_y\)</span>的数，分别都乘上<span class="math inline">\(c\)</span>。</p></li>
<li><p>将<span class="math inline">\(a_x\)</span>到<span class="math inline">\(a_y\)</span>的数，都改为<span class="math inline">\(c\)</span>。</p></li>
<li><p>求<span class="math inline">\(a_x\)</span>到<span class="math inline">\(a_y\)</span>的数的<span class="math inline">\(p\)</span>次幂的总和。即<span class="math inline">\(a_x^p+a_{x+1}^p+a_{x+2}^p+...+a_{y}^p\)</span>。其中，<span class="math inline">\(0 \lt p \lt 4\)</span>，<span class="math inline">\(p\)</span>是整数。</p>
<p>这是一道比较复杂的题目，难点在于怎么维护<span class="math inline">\(p\)</span>次幂的区间和，以及加操作与乘操作之间的相互影响怎么处理。事实上根据以下两条式子来维护三次方和以及二次方和即可： <span class="math display">\[
(x+c)^3=x^3+3cx^2+3c^2x+c^3 \\
(x+c)^2=x^2+2cx+c^2
\]</span> 具体的看代码注释吧。</p>
<p>代码如下</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb10-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb10-14" title="14"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb10-15" title="15"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="fl">1e5</span>+<span class="dv">5</span>;</a>
<a class="sourceLine" id="cb10-19" title="19"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb10-20" title="20"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb10-21" title="21"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb10-22" title="22">ll mod=<span class="dv">10007</span>;</a>
<a class="sourceLine" id="cb10-23" title="23">ll sum1[maxn&lt;&lt;<span class="dv">2</span>];        <span class="co">//区间和 </span></a>
<a class="sourceLine" id="cb10-24" title="24">ll sum2[maxn&lt;&lt;<span class="dv">2</span>];        <span class="co">//区间平方和 </span></a>
<a class="sourceLine" id="cb10-25" title="25">ll sum3[maxn&lt;&lt;<span class="dv">2</span>];        <span class="co">//区间立方和</span></a>
<a class="sourceLine" id="cb10-26" title="26">ll lazy_add[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb10-27" title="27">ll lazy_mul[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb10-28" title="28">ll lazy_set[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb10-29" title="29"><span class="dt">void</span> push_up(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb10-30" title="30">{</a>
<a class="sourceLine" id="cb10-31" title="31">    sum1[rt]=(sum1[rt&lt;&lt;<span class="dv">1</span>]+sum1[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>])%mod;</a>
<a class="sourceLine" id="cb10-32" title="32">    sum2[rt]=(sum2[rt&lt;&lt;<span class="dv">1</span>]+sum2[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>])%mod;</a>
<a class="sourceLine" id="cb10-33" title="33">    sum3[rt]=(sum3[rt&lt;&lt;<span class="dv">1</span>]+sum3[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>])%mod; </a>
<a class="sourceLine" id="cb10-34" title="34">}</a>
<a class="sourceLine" id="cb10-35" title="35"><span class="dt">void</span> build(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb10-36" title="36">{</a>
<a class="sourceLine" id="cb10-37" title="37">    sum1[rt]=sum2[rt]=sum3[rt]=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-38" title="38">    lazy_add[rt]=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-39" title="39">    lazy_mul[rt]=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb10-40" title="40">    lazy_set[rt]=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-41" title="41">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb10-42" title="42"><span class="co">//        sum1[rt]=sum2[rt]=sum3[rt]=0;</span></a>
<a class="sourceLine" id="cb10-43" title="43">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb10-44" title="44">    }</a>
<a class="sourceLine" id="cb10-45" title="45">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb10-46" title="46">    build(lson);</a>
<a class="sourceLine" id="cb10-47" title="47">    build(rson);</a>
<a class="sourceLine" id="cb10-48" title="48">    push_up(rt);</a>
<a class="sourceLine" id="cb10-49" title="49">}</a>
<a class="sourceLine" id="cb10-50" title="50"><span class="dt">void</span> push_down(<span class="dt">int</span> rt,<span class="dt">int</span> len)</a>
<a class="sourceLine" id="cb10-51" title="51">{</a>
<a class="sourceLine" id="cb10-52" title="52">    <span class="cf">if</span>(lazy_set[rt]!=<span class="dv">0</span>){</a>
<a class="sourceLine" id="cb10-53" title="53">        lazy_add[rt&lt;&lt;<span class="dv">1</span>]=lazy_add[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=<span class="dv">0</span>;        </a>
<a class="sourceLine" id="cb10-54" title="54">        lazy_mul[rt&lt;&lt;<span class="dv">1</span>]=lazy_mul[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb10-55" title="55">        lazy_set[rt&lt;&lt;<span class="dv">1</span>]=lazy_set[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=lazy_set[rt];</a>
<a class="sourceLine" id="cb10-56" title="56">        ll tmp=(lazy_set[rt]*(lazy_set[rt]%mod)*(lazy_set[rt]%mod))%mod;</a>
<a class="sourceLine" id="cb10-57" title="57">        sum3[rt&lt;&lt;<span class="dv">1</span>]=((len-(len&gt;&gt;<span class="dv">1</span>))*tmp)%mod;</a>
<a class="sourceLine" id="cb10-58" title="58">        sum3[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=((len&gt;&gt;<span class="dv">1</span>)*tmp)%mod;</a>
<a class="sourceLine" id="cb10-59" title="59"></a>
<a class="sourceLine" id="cb10-60" title="60">        sum2[rt&lt;&lt;<span class="dv">1</span>]=((len-(len&gt;&gt;<span class="dv">1</span>))*((lazy_set[rt]%mod)*(lazy_set[rt]%mod)))%mod;</a>
<a class="sourceLine" id="cb10-61" title="61">        sum2[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=((len&gt;&gt;<span class="dv">1</span>)*((lazy_set[rt]%mod)*(lazy_set[rt]%mod)))%mod;</a>
<a class="sourceLine" id="cb10-62" title="62"></a>
<a class="sourceLine" id="cb10-63" title="63">        sum1[rt&lt;&lt;<span class="dv">1</span>]=((len-(len&gt;&gt;<span class="dv">1</span>))*(lazy_set[rt]%mod))%mod;</a>
<a class="sourceLine" id="cb10-64" title="64">        sum1[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=((len&gt;&gt;<span class="dv">1</span>)*(lazy_set[rt]%mod))%mod;</a>
<a class="sourceLine" id="cb10-65" title="65"></a>
<a class="sourceLine" id="cb10-66" title="66">        lazy_set[rt]=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-67" title="67">    }</a>
<a class="sourceLine" id="cb10-68" title="68">    <span class="cf">if</span>(lazy_add[rt]!=<span class="dv">0</span>||lazy_mul[rt]!=<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb10-69" title="69">        ll add=lazy_add[rt];ll mul=lazy_mul[rt];</a>
<a class="sourceLine" id="cb10-70" title="70">        ll tmp=(mul*mul%mod*mul%mod)%mod;</a>
<a class="sourceLine" id="cb10-71" title="71"></a>
<a class="sourceLine" id="cb10-72" title="72">        lazy_add[rt&lt;&lt;<span class="dv">1</span>]=(lazy_add[rt&lt;&lt;<span class="dv">1</span>]*mul%mod+add%mod)%mod;</a>
<a class="sourceLine" id="cb10-73" title="73">        lazy_add[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=(lazy_add[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]*mul%mod+add%mod)%mod;</a>
<a class="sourceLine" id="cb10-74" title="74">        lazy_mul[rt&lt;&lt;<span class="dv">1</span>]=(lazy_mul[rt&lt;&lt;<span class="dv">1</span>]%mod*mul%mod)%mod;</a>
<a class="sourceLine" id="cb10-75" title="75">        lazy_mul[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=(lazy_mul[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]*mul%mod)%mod;</a>
<a class="sourceLine" id="cb10-76" title="76"></a>
<a class="sourceLine" id="cb10-77" title="77">        sum3[rt&lt;&lt;<span class="dv">1</span>]=(sum3[rt&lt;&lt;<span class="dv">1</span>]*tmp%mod+add*add%mod*add%mod*(len-(len&gt;&gt;<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb10-78" title="78">                    +<span class="dv">3</span>*sum2[rt&lt;&lt;<span class="dv">1</span>]*mul*mul%mod*add%mod+<span class="dv">3</span>*sum1[rt&lt;&lt;<span class="dv">1</span>]*mul</a>
<a class="sourceLine" id="cb10-79" title="79">                    *add%mod*add%mod)%mod;        <span class="co">//(x + c)^3 = x^3 + 3cx^2 + 3(c^2)x + c^3</span></a>
<a class="sourceLine" id="cb10-80" title="80">        sum3[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=(sum3[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]*tmp%mod+add*add%mod*add%mod*(len&gt;&gt;<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-81" title="81">                    +<span class="dv">3</span>*sum2[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]*mul*mul%mod*add%mod+<span class="dv">3</span>*sum1[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]*mul</a>
<a class="sourceLine" id="cb10-82" title="82">                    *add%mod*add%mod)%mod;        <span class="co">//(x + c)^3 = x^3 + 3cx^2 + 3(c^2)x + c^3</span></a>
<a class="sourceLine" id="cb10-83" title="83"></a>
<a class="sourceLine" id="cb10-84" title="84">        sum2[rt&lt;&lt;<span class="dv">1</span>]=(sum2[rt&lt;&lt;<span class="dv">1</span>]*mul*mul%mod+add*add%mod*(len-(len&gt;&gt;<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb10-85" title="85">                    +<span class="dv">2</span>*mul*add%mod*sum1[rt&lt;&lt;<span class="dv">1</span>]%mod)%mod;    <span class="co">//(x + c)^2 = x^2 + 2cx + c^2</span></a>
<a class="sourceLine" id="cb10-86" title="86">        sum2[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=(sum2[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]*mul*mul%mod+add*add%mod*(len&gt;&gt;<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-87" title="87">                    +<span class="dv">2</span>*mul*add%mod*sum1[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]%mod)%mod;    <span class="co">//(x + c)^2 = x^2 + 2cx + c^2</span></a>
<a class="sourceLine" id="cb10-88" title="88"></a>
<a class="sourceLine" id="cb10-89" title="89">        sum1[rt&lt;&lt;<span class="dv">1</span>]=(sum1[rt&lt;&lt;<span class="dv">1</span>]*mul%mod+add%mod*(len-(len&gt;&gt;<span class="dv">1</span>)))%mod;</a>
<a class="sourceLine" id="cb10-90" title="90">        sum1[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=(sum1[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]*mul%mod+add%mod*(len&gt;&gt;<span class="dv">1</span>))%mod;</a>
<a class="sourceLine" id="cb10-91" title="91"></a>
<a class="sourceLine" id="cb10-92" title="92">        lazy_add[rt]=<span class="dv">0</span>;lazy_mul[rt]=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb10-93" title="93">    }</a>
<a class="sourceLine" id="cb10-94" title="94">}</a>
<a class="sourceLine" id="cb10-95" title="95"><span class="co">/*</span></a>
<a class="sourceLine" id="cb10-96" title="96"><span class="co">op==1:add </span></a>
<a class="sourceLine" id="cb10-97" title="97"><span class="co">op==2:mul</span></a>
<a class="sourceLine" id="cb10-98" title="98"><span class="co">op==3:set</span></a>
<a class="sourceLine" id="cb10-99" title="99"><span class="co">*/</span></a>
<a class="sourceLine" id="cb10-100" title="100"><span class="dt">void</span> update(<span class="dt">int</span> op,<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> todo,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb10-101" title="101">{</a>
<a class="sourceLine" id="cb10-102" title="102">    <span class="cf">if</span>(toR&lt;lef||toL&gt;rig)        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb10-103" title="103">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;toR&gt;=rig){</a>
<a class="sourceLine" id="cb10-104" title="104">        <span class="cf">if</span>(op==<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb10-105" title="105">            lazy_add[rt]=(todo+lazy_add[rt])%mod;</a>
<a class="sourceLine" id="cb10-106" title="106">            sum3[rt]=(sum3[rt]+(todo*todo%mod*todo%mod*(rig-lef+<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb10-107" title="107">            +<span class="dv">3</span>*todo%mod*sum2[rt]%mod+<span class="dv">3</span>*todo*todo%mod*sum1[rt]%mod)%mod;</a>
<a class="sourceLine" id="cb10-108" title="108">            <span class="co">//(x + c)^3 = x^3 + 3cx^2 + 3(c^2)x + c^3</span></a>
<a class="sourceLine" id="cb10-109" title="109">            sum2[rt]=(sum2[rt]+(todo*todo%mod)*(rig-lef+<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-110" title="110">            +<span class="dv">2</span>*sum1[rt]%mod*todo%mod)%mod;</a>
<a class="sourceLine" id="cb10-111" title="111"></a>
<a class="sourceLine" id="cb10-112" title="112">            sum1[rt]=(sum1[rt]+(rig-lef+<span class="dv">1</span>)*todo%mod)%mod;</a>
<a class="sourceLine" id="cb10-113" title="113">        }<span class="cf">else</span> <span class="cf">if</span>(op==<span class="dv">2</span>){</a>
<a class="sourceLine" id="cb10-114" title="114">            lazy_add[rt]=(lazy_add[rt]*todo)%mod;</a>
<a class="sourceLine" id="cb10-115" title="115">            lazy_mul[rt]=(lazy_mul[rt]*todo)%mod;</a>
<a class="sourceLine" id="cb10-116" title="116">            sum1[rt]=(todo*sum1[rt])%mod;</a>
<a class="sourceLine" id="cb10-117" title="117">            sum2[rt]=(todo*todo%mod*sum2[rt])%mod;</a>
<a class="sourceLine" id="cb10-118" title="118">            sum3[rt]=(todo*todo%mod*todo%mod*sum3[rt]%mod)%mod;</a>
<a class="sourceLine" id="cb10-119" title="119">        }<span class="cf">else</span> <span class="cf">if</span>(op==<span class="dv">3</span>){</a>
<a class="sourceLine" id="cb10-120" title="120">            lazy_add[rt]=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-121" title="121">            lazy_mul[rt]=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb10-122" title="122">            lazy_set[rt]=todo;</a>
<a class="sourceLine" id="cb10-123" title="123">            sum3[rt]=(rig-lef+<span class="dv">1</span>)%mod*todo*todo%mod*todo%mod;</a>
<a class="sourceLine" id="cb10-124" title="124">            sum2[rt]=(rig-lef+<span class="dv">1</span>)%mod*todo*todo%mod;</a>
<a class="sourceLine" id="cb10-125" title="125">            sum1[rt]=(rig-lef+<span class="dv">1</span>)%mod*todo%mod;</a>
<a class="sourceLine" id="cb10-126" title="126">        }</a>
<a class="sourceLine" id="cb10-127" title="127">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb10-128" title="128">    }</a>
<a class="sourceLine" id="cb10-129" title="129">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb10-130" title="130">    push_down(rt,rig-lef+<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb10-131" title="131">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb10-132" title="132">        update(op,toL,toR,todo,lson);</a>
<a class="sourceLine" id="cb10-133" title="133">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb10-134" title="134">        update(op,toL,toR,todo,rson);</a>
<a class="sourceLine" id="cb10-135" title="135">    push_up(rt);</a>
<a class="sourceLine" id="cb10-136" title="136">}</a>
<a class="sourceLine" id="cb10-137" title="137">ll query(<span class="dt">int</span> p,<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb10-138" title="138">{</a>
<a class="sourceLine" id="cb10-139" title="139">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;toR&gt;=rig){</a>
<a class="sourceLine" id="cb10-140" title="140">        <span class="cf">if</span>(p==<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-141" title="141">            <span class="cf">return</span> sum1[rt];</a>
<a class="sourceLine" id="cb10-142" title="142">        <span class="cf">else</span> <span class="cf">if</span>(p==<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-143" title="143">            <span class="cf">return</span> sum2[rt];</a>
<a class="sourceLine" id="cb10-144" title="144">        <span class="cf">else</span> <span class="cf">if</span>(p==<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb10-145" title="145">            <span class="cf">return</span> sum3[rt]; </a>
<a class="sourceLine" id="cb10-146" title="146">    }</a>
<a class="sourceLine" id="cb10-147" title="147">    <span class="cf">if</span>(lef==rig)        <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-148" title="148">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb10-149" title="149">    push_down(rt,rig-lef+<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb10-150" title="150">    ll ret=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-151" title="151">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb10-152" title="152">        ret+=query(p,toL,toR,lson);</a>
<a class="sourceLine" id="cb10-153" title="153">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb10-154" title="154">        ret+=query(p,toL,toR,rson);</a>
<a class="sourceLine" id="cb10-155" title="155">    <span class="cf">return</span> ret%mod;</a>
<a class="sourceLine" id="cb10-156" title="156">}</a>
<a class="sourceLine" id="cb10-157" title="157"><span class="co">//void update(int op,int toL,int toR,int todo,int lef,int rig,int rt)</span></a>
<a class="sourceLine" id="cb10-158" title="158"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb10-159" title="159">{</a>
<a class="sourceLine" id="cb10-160" title="160"><span class="co">//    freopen("data_generator.txt","r",stdin);</span></a>
<a class="sourceLine" id="cb10-161" title="161"><span class="co">//    freopen("out_hdu4578.txt","w",stdout);</span></a>
<a class="sourceLine" id="cb10-162" title="162">    <span class="dt">int</span> n,m;</a>
<a class="sourceLine" id="cb10-163" title="163">    <span class="cf">while</span>(scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;n,&amp;m)!=EOF&amp;&amp;n&amp;&amp;m){</a>
<a class="sourceLine" id="cb10-164" title="164"><span class="co">//        mst(sum1,0);mst(sum2,0);mst(sum3,0);</span></a>
<a class="sourceLine" id="cb10-165" title="165"><span class="co">//        mst(lazy_add,0);mst(lazy_mul,0);mst(lazy_set,0);</span></a>
<a class="sourceLine" id="cb10-166" title="166">        build(<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb10-167" title="167">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;m;i++){</a>
<a class="sourceLine" id="cb10-168" title="168">            <span class="dt">int</span> type;</a>
<a class="sourceLine" id="cb10-169" title="169">            scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;type);</a>
<a class="sourceLine" id="cb10-170" title="170">            <span class="dt">int</span> a,b,c;</a>
<a class="sourceLine" id="cb10-171" title="171">            c%=mod; </a>
<a class="sourceLine" id="cb10-172" title="172">            scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;a,&amp;b,&amp;c);</a>
<a class="sourceLine" id="cb10-173" title="173">            <span class="cf">if</span>(type!=<span class="dv">4</span>){</a>
<a class="sourceLine" id="cb10-174" title="174">                update(type,a,b,c,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb10-175" title="175">            }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb10-176" title="176">                ll ans=query(c,a,b,<span class="dv">1</span>,n,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb10-177" title="177">                ans%=mod;</a>
<a class="sourceLine" id="cb10-178" title="178">                printf(<span class="st">"</span><span class="sc">%lld\n</span><span class="st">"</span>,ans);</a>
<a class="sourceLine" id="cb10-179" title="179">            }</a>
<a class="sourceLine" id="cb10-180" title="180">        }</a>
<a class="sourceLine" id="cb10-181" title="181">    }</a>
<a class="sourceLine" id="cb10-182" title="182">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-183" title="183">}</a></code></pre></div></li>
</ul>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/HDU-4614">HDU4614 Vases and Flowers</a></p>
<p>题意是说，有若干个花瓶，有两种操作，分别是</p>
<ul>
<li>从花瓶A开始放F朵花，如果某个花瓶已经有花了，就跳过这个花瓶。不断尝试花瓶，直至所有花都放完了，或者A以及A以后的花瓶都被尝试了一边。输出放第一朵花的位置以及放最后一朵花的位置。</li>
<li>第二种操作则是清楚区间内的花。并输出清除了多少花</li>
</ul>
<p>思路是，空花瓶用1表示，线段树提供set操作，维护区间和。清空花瓶的操作很简单，只需要查询一下区间和，然后用区间长度减去区间和即可。对于放花的操作，可以用二分找到左边界和右边界。具体见代码及注释。</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb11-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb11-14" title="14"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb11-15" title="15"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="dv">50005</span>;</a>
<a class="sourceLine" id="cb11-19" title="19"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb11-20" title="20"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb11-21" title="21"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb11-22" title="22"><span class="dt">int</span> lazy[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb11-23" title="23"><span class="dt">int</span> sum[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb11-24" title="24"><span class="dt">int</span> n,m;</a>
<a class="sourceLine" id="cb11-25" title="25"><span class="dt">void</span> pushup(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb11-26" title="26">{</a>
<a class="sourceLine" id="cb11-27" title="27">    sum[rt]=sum[rt&lt;&lt;<span class="dv">1</span>]+sum[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb11-28" title="28">}</a>
<a class="sourceLine" id="cb11-29" title="29"><span class="dt">void</span> build(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb11-30" title="30">{</a>
<a class="sourceLine" id="cb11-31" title="31">    lazy[rt]=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb11-32" title="32">    <span class="cf">if</span>(lef==rig){</a>
<a class="sourceLine" id="cb11-33" title="33">        sum[rt]=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb11-34" title="34">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb11-35" title="35">    }</a>
<a class="sourceLine" id="cb11-36" title="36">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb11-37" title="37">    build(lson);</a>
<a class="sourceLine" id="cb11-38" title="38">    build(rson);</a>
<a class="sourceLine" id="cb11-39" title="39">    pushup(rt);</a>
<a class="sourceLine" id="cb11-40" title="40">}</a>
<a class="sourceLine" id="cb11-41" title="41"><span class="dt">void</span> pushdown(<span class="dt">int</span> rt,<span class="dt">int</span> len)</a>
<a class="sourceLine" id="cb11-42" title="42">{</a>
<a class="sourceLine" id="cb11-43" title="43">    <span class="cf">if</span>(lazy[rt]!=-<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb11-44" title="44">        lazy[rt&lt;&lt;<span class="dv">1</span>]=lazy[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=lazy[rt];</a>
<a class="sourceLine" id="cb11-45" title="45">        sum[rt&lt;&lt;<span class="dv">1</span>]=lazy[rt]*(len-(len&gt;&gt;<span class="dv">1</span>));</a>
<a class="sourceLine" id="cb11-46" title="46">        sum[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]=lazy[rt]*(len&gt;&gt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb11-47" title="47">        lazy[rt]=-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb11-48" title="48">    }</a>
<a class="sourceLine" id="cb11-49" title="49">}</a>
<a class="sourceLine" id="cb11-50" title="50"><span class="dt">void</span> update(<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> todo,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)        <span class="co">//进行set操作    //空花瓶用1表示 </span></a>
<a class="sourceLine" id="cb11-51" title="51">{</a>
<a class="sourceLine" id="cb11-52" title="52">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;rig&lt;=toR){</a>
<a class="sourceLine" id="cb11-53" title="53">        lazy[rt]=todo;</a>
<a class="sourceLine" id="cb11-54" title="54">        sum[rt]=(rig-lef+<span class="dv">1</span>)*todo;</a>
<a class="sourceLine" id="cb11-55" title="55">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb11-56" title="56">    }</a>
<a class="sourceLine" id="cb11-57" title="57">    pushdown(rt,rig-lef+<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb11-58" title="58">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb11-59" title="59">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb11-60" title="60">        update(toL,toR,todo,lson);</a>
<a class="sourceLine" id="cb11-61" title="61">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb11-62" title="62">        update(toL,toR,todo,rson);</a>
<a class="sourceLine" id="cb11-63" title="63">    pushup(rt);</a>
<a class="sourceLine" id="cb11-64" title="64">} </a>
<a class="sourceLine" id="cb11-65" title="65"><span class="dt">int</span> query(<span class="dt">int</span> toL,<span class="dt">int</span> toR,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb11-66" title="66">{</a>
<a class="sourceLine" id="cb11-67" title="67">    <span class="cf">if</span>(toL&lt;=lef&amp;&amp;rig&lt;=toR){</a>
<a class="sourceLine" id="cb11-68" title="68">        <span class="cf">return</span> sum[rt];</a>
<a class="sourceLine" id="cb11-69" title="69">    }</a>
<a class="sourceLine" id="cb11-70" title="70">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb11-71" title="71">    pushdown(rt,rig-lef+<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb11-72" title="72">    <span class="dt">int</span> ret=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb11-73" title="73">    <span class="cf">if</span>(toL&lt;=mid)</a>
<a class="sourceLine" id="cb11-74" title="74">        ret+=query(toL,toR,lson);</a>
<a class="sourceLine" id="cb11-75" title="75">    <span class="cf">if</span>(toR&gt;mid)</a>
<a class="sourceLine" id="cb11-76" title="76">        ret+=query(toL,toR,rson);</a>
<a class="sourceLine" id="cb11-77" title="77">    <span class="cf">return</span> ret;</a>
<a class="sourceLine" id="cb11-78" title="78">}</a>
<a class="sourceLine" id="cb11-79" title="79"><span class="dt">int</span> binary(<span class="dt">int</span> L,<span class="dt">int</span> R,<span class="dt">int</span> num,<span class="dt">int</span> cnt)        <span class="co">//cnt为要找的空花瓶的数目 </span></a>
<a class="sourceLine" id="cb11-80" title="80">{</a>
<a class="sourceLine" id="cb11-81" title="81">    <span class="dt">int</span> ans=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb11-82" title="82">    <span class="dt">int</span> mid=L+(R-L)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb11-83" title="83">    <span class="cf">while</span>(L&lt;=R){</a>
<a class="sourceLine" id="cb11-84" title="84">        mid=L+(R-L)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb11-85" title="85">        <span class="cf">if</span>(query(<span class="dv">0</span>,mid,<span class="dv">0</span>,n-<span class="dv">1</span>,<span class="dv">1</span>)-num&gt;=cnt){</a>
<a class="sourceLine" id="cb11-86" title="86">            R=mid-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb11-87" title="87">            ans=mid;</a>
<a class="sourceLine" id="cb11-88" title="88">        }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb11-89" title="89">            L=mid+<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb11-90" title="90">        }</a>
<a class="sourceLine" id="cb11-91" title="91">    }</a>
<a class="sourceLine" id="cb11-92" title="92">    <span class="cf">return</span> ans;</a>
<a class="sourceLine" id="cb11-93" title="93">}</a>
<a class="sourceLine" id="cb11-94" title="94"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb11-95" title="95">{</a>
<a class="sourceLine" id="cb11-96" title="96">    <span class="dt">int</span> t;cin&gt;&gt;t;</a>
<a class="sourceLine" id="cb11-97" title="97">    <span class="cf">while</span>(t--){</a>
<a class="sourceLine" id="cb11-98" title="98">        cin&gt;&gt;n&gt;&gt;m;</a>
<a class="sourceLine" id="cb11-99" title="99">        build(<span class="dv">0</span>,n-<span class="dv">1</span>,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb11-100" title="100">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;m;i++){</a>
<a class="sourceLine" id="cb11-101" title="101">            <span class="dt">int</span> op;<span class="dt">int</span> x,y;</a>
<a class="sourceLine" id="cb11-102" title="102">            cin&gt;&gt;op&gt;&gt;x&gt;&gt;y;</a>
<a class="sourceLine" id="cb11-103" title="103">            <span class="cf">if</span>(op==<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb11-104" title="104">                <span class="dt">int</span> tot=query(x,n-<span class="dv">1</span>,<span class="dv">0</span>,n-<span class="dv">1</span>,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb11-105" title="105">                <span class="cf">if</span>(tot==<span class="dv">0</span>){</a>
<a class="sourceLine" id="cb11-106" title="106">                    printf(<span class="st">"Can not put any one.</span><span class="sc">\n</span><span class="st">"</span>);</a>
<a class="sourceLine" id="cb11-107" title="107">                    <span class="cf">continue</span>;</a>
<a class="sourceLine" id="cb11-108" title="108">                }</a>
<a class="sourceLine" id="cb11-109" title="109">                <span class="cf">if</span>(tot&lt;y)        y=tot;    <span class="co">//tot为从x开始最多能放的花的数目 </span></a>
<a class="sourceLine" id="cb11-110" title="110">                <span class="dt">int</span> nu=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb11-111" title="111">                <span class="cf">if</span>(x&gt;=<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb11-112" title="112">                    nu=query(<span class="dv">0</span>,x-<span class="dv">1</span>,<span class="dv">0</span>,n-<span class="dv">1</span>,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb11-113" title="113">                <span class="cf">else</span></a>
<a class="sourceLine" id="cb11-114" title="114">                    nu=<span class="dv">0</span>;        <span class="co">//此时x-1为负数，要特判一下 </span></a>
<a class="sourceLine" id="cb11-115" title="115">                <span class="dt">int</span> lef=binary(x,n-<span class="dv">1</span>,nu,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb11-116" title="116">                <span class="dt">int</span> rig=binary(x,n-<span class="dv">1</span>,nu,y);</a>
<a class="sourceLine" id="cb11-117" title="117">                cout&lt;&lt;lef&lt;&lt;<span class="st">" "</span>&lt;&lt;rig&lt;&lt;endl;</a>
<a class="sourceLine" id="cb11-118" title="118">                update(lef,rig,<span class="dv">0</span>,<span class="dv">0</span>,n-<span class="dv">1</span>,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb11-119" title="119">            }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb11-120" title="120">                <span class="dt">int</span> ans=(y-x+<span class="dv">1</span>)-query(x,y,<span class="dv">0</span>,n-<span class="dv">1</span>,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb11-121" title="121">                cout&lt;&lt;ans&lt;&lt;endl;</a>
<a class="sourceLine" id="cb11-122" title="122">                update(x,y,<span class="dv">1</span>,<span class="dv">0</span>,n-<span class="dv">1</span>,<span class="dv">1</span>);        <span class="co">//1表示空花瓶 </span></a>
<a class="sourceLine" id="cb11-123" title="123">            }</a>
<a class="sourceLine" id="cb11-124" title="124">        }</a>
<a class="sourceLine" id="cb11-125" title="125">        printf(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>);</a>
<a class="sourceLine" id="cb11-126" title="126">    }</a>
<a class="sourceLine" id="cb11-127" title="127">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb11-128" title="128">}</a></code></pre></div>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/POJ-1177">POJ1177 Picture</a></p>
<p>题目是让我们求若干个矩形重叠后形成的大矩形的周长。 扫描线题目，但一般来说扫描线都是用来求取重叠面积的，而此处是求取周长。线段树维护区间中被覆盖的长度以及区间中线段的数目。之所以要维护线段长度，是因为在计算矩形<span class="math inline">\(y\)</span>方向上的周长时需要用到。每次update的时候根据线段树更新区间结果即可。 代码如下:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb12-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="pp">#include </span><span class="im">&lt;utility&gt;</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="pp">#include </span><span class="im">&lt;stack&gt;</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb12-16" title="16"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb12-17" title="17"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb12-19" title="19"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb12-20" title="20"><span class="pp">#define IOS </span><span class="bu">std::</span>ios<span class="bu">::</span>sync_with_stdio(<span class="kw">false</span>)</a>
<a class="sourceLine" id="cb12-21" title="21"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="dv">20005</span>;</a>
<a class="sourceLine" id="cb12-22" title="22"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb12-23" title="23"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb12-24" title="24"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb12-25" title="25"><span class="kw">struct</span> seg{</a>
<a class="sourceLine" id="cb12-26" title="26">    <span class="dt">int</span> lef,rig;</a>
<a class="sourceLine" id="cb12-27" title="27">    <span class="dt">int</span> h;</a>
<a class="sourceLine" id="cb12-28" title="28">    <span class="dt">int</span> tag;</a>
<a class="sourceLine" id="cb12-29" title="29">    seg(){</a>
<a class="sourceLine" id="cb12-30" title="30">    }</a>
<a class="sourceLine" id="cb12-31" title="31">    seg(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> h,<span class="dt">int</span> tag)</a>
<a class="sourceLine" id="cb12-32" title="32">        :lef(lef),rig(rig),h(h),tag(tag){</a>
<a class="sourceLine" id="cb12-33" title="33">        }</a>
<a class="sourceLine" id="cb12-34" title="34">    <span class="dt">bool</span> <span class="kw">operator</span>&lt;(<span class="at">const</span> seg&amp; se) <span class="at">const</span>{</a>
<a class="sourceLine" id="cb12-35" title="35">        <span class="cf">return</span> h&lt;se.h;</a>
<a class="sourceLine" id="cb12-36" title="36">    }</a>
<a class="sourceLine" id="cb12-37" title="37">};</a>
<a class="sourceLine" id="cb12-38" title="38">seg segs[<span class="dv">5005</span>*<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb12-39" title="39"><span class="kw">struct</span> node{        <span class="co">//表示一个区间 </span></a>
<a class="sourceLine" id="cb12-40" title="40">    <span class="dt">int</span> lef,rig;    <span class="co">//左右端点 </span></a>
<a class="sourceLine" id="cb12-41" title="41">    <span class="dt">int</span> len;        <span class="co">//被覆盖的长度 </span></a>
<a class="sourceLine" id="cb12-42" title="42">    <span class="dt">int</span> cover_cnt;    <span class="co">//被覆盖的次数 </span></a>
<a class="sourceLine" id="cb12-43" title="43">    <span class="dt">bool</span> lc,rc;        <span class="co">//左右端点是否被覆盖 </span></a>
<a class="sourceLine" id="cb12-44" title="44">    <span class="dt">int</span> num;        <span class="co">//区间中线段数目 </span></a>
<a class="sourceLine" id="cb12-45" title="45">    node(){</a>
<a class="sourceLine" id="cb12-46" title="46">    }</a>
<a class="sourceLine" id="cb12-47" title="47">};</a>
<a class="sourceLine" id="cb12-48" title="48">node ns[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb12-49" title="49"><span class="dt">void</span> build(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb12-50" title="50">{</a>
<a class="sourceLine" id="cb12-51" title="51">    ns[rt].lef=lef;ns[rt].rig=rig;</a>
<a class="sourceLine" id="cb12-52" title="52">    ns[rt].len=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb12-53" title="53">    ns[rt].cover_cnt=ns[rt].lc=ns[rt].rc=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb12-54" title="54">    ns[rt].num=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb12-55" title="55">    <span class="cf">if</span>(lef==rig)</a>
<a class="sourceLine" id="cb12-56" title="56">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb12-57" title="57">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb12-58" title="58">    build(lson);</a>
<a class="sourceLine" id="cb12-59" title="59">    build(rson); </a>
<a class="sourceLine" id="cb12-60" title="60">}</a>
<a class="sourceLine" id="cb12-61" title="61"><span class="dt">void</span> pushup(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb12-62" title="62">{</a>
<a class="sourceLine" id="cb12-63" title="63">    <span class="cf">if</span>(ns[rt].cover_cnt){</a>
<a class="sourceLine" id="cb12-64" title="64">        ns[rt].len=ns[rt].rig-ns[rt].lef+<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb12-65" title="65">        ns[rt].lc=ns[rt].rc=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb12-66" title="66">        ns[rt].num=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb12-67" title="67">    }<span class="cf">else</span> <span class="cf">if</span>(ns[rt].lef==ns[rt].rig){</a>
<a class="sourceLine" id="cb12-68" title="68">        ns[rt].len=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb12-69" title="69">        ns[rt].lc=ns[rt].rc=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb12-70" title="70">        ns[rt].num=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb12-71" title="71">    }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb12-72" title="72">        <span class="dt">int</span> tmp=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb12-73" title="73">        <span class="cf">if</span>(ns[rt&lt;&lt;<span class="dv">1</span>].rc&amp;&amp;ns[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].lc)</a>
<a class="sourceLine" id="cb12-74" title="74">            tmp=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb12-75" title="75">        ns[rt].len=ns[rt&lt;&lt;<span class="dv">1</span>].len+ns[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].len;</a>
<a class="sourceLine" id="cb12-76" title="76">        ns[rt].num=ns[rt&lt;&lt;<span class="dv">1</span>].num+ns[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].num-tmp;        </a>
<a class="sourceLine" id="cb12-77" title="77">        <span class="co">//当左儿子的右端点以及右儿子的左端点完全被覆盖时，中间会有一段被重复计算</span></a>
<a class="sourceLine" id="cb12-78" title="78">        <span class="co">//的线段，故需要将其减去. </span></a>
<a class="sourceLine" id="cb12-79" title="79">        ns[rt].lc=ns[rt&lt;&lt;<span class="dv">1</span>].lc;ns[rt].rc=ns[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].rc;</a>
<a class="sourceLine" id="cb12-80" title="80">    }</a>
<a class="sourceLine" id="cb12-81" title="81">}</a>
<a class="sourceLine" id="cb12-82" title="82"><span class="dt">void</span> update(<span class="dt">int</span> val,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)        <span class="co">//根据扫描线对线段树节点进行更新</span></a>
<a class="sourceLine" id="cb12-83" title="83"><span class="co">//参数表中的lef和rig表示扫描线的左右端点 </span></a>
<a class="sourceLine" id="cb12-84" title="84">{</a>
<a class="sourceLine" id="cb12-85" title="85"><span class="co">//    cout&lt;&lt;"rt = "&lt;&lt;rt&lt;&lt;endl;</span></a>
<a class="sourceLine" id="cb12-86" title="86">    <span class="cf">if</span>(lef==ns[rt].lef&amp;&amp;ns[rt].rig==rig){</a>
<a class="sourceLine" id="cb12-87" title="87">        ns[rt].cover_cnt+=val;</a>
<a class="sourceLine" id="cb12-88" title="88">        pushup(rt);</a>
<a class="sourceLine" id="cb12-89" title="89">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb12-90" title="90">    }</a>
<a class="sourceLine" id="cb12-91" title="91">    <span class="dt">int</span> mid=(ns[rt].lef)+(ns[rt].rig-ns[rt].lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb12-92" title="92">    <span class="cf">if</span>(rig&lt;=mid){</a>
<a class="sourceLine" id="cb12-93" title="93">        update(val,lef,rig,rt&lt;&lt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb12-94" title="94">    }<span class="cf">else</span> <span class="cf">if</span>(lef&gt;mid){</a>
<a class="sourceLine" id="cb12-95" title="95">        update(val,lef,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb12-96" title="96">    }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb12-97" title="97">        update(val,lef,mid,rt&lt;&lt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb12-98" title="98">        update(val,mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb12-99" title="99">    }</a>
<a class="sourceLine" id="cb12-100" title="100">    pushup(rt);</a>
<a class="sourceLine" id="cb12-101" title="101">}</a>
<a class="sourceLine" id="cb12-102" title="102"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb12-103" title="103">{</a>
<a class="sourceLine" id="cb12-104" title="104">    IOS;</a>
<a class="sourceLine" id="cb12-105" title="105">    <span class="dt">int</span> n;cin&gt;&gt;n;</a>
<a class="sourceLine" id="cb12-106" title="106">    <span class="dt">int</span> cnt=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb12-107" title="107">    <span class="dt">int</span> ub=-INF;</a>
<a class="sourceLine" id="cb12-108" title="108">    <span class="dt">int</span> lb=INF;</a>
<a class="sourceLine" id="cb12-109" title="109">    <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n;i++){</a>
<a class="sourceLine" id="cb12-110" title="110">        <span class="dt">int</span> x1,y1,x2,y2;</a>
<a class="sourceLine" id="cb12-111" title="111">        cin&gt;&gt;x1&gt;&gt;y1&gt;&gt;x2&gt;&gt;y2;</a>
<a class="sourceLine" id="cb12-112" title="112">        segs[cnt++]=seg(x1,x2,y1,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb12-113" title="113">        segs[cnt++]=seg(x1,x2,y2,-<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb12-114" title="114">        ub=max(ub,x2);</a>
<a class="sourceLine" id="cb12-115" title="115">        lb=min(lb,x1);        </a>
<a class="sourceLine" id="cb12-116" title="116">    }</a>
<a class="sourceLine" id="cb12-117" title="117">    sort(segs,segs+cnt);</a>
<a class="sourceLine" id="cb12-118" title="118">    build(lb,ub,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb12-119" title="119">    <span class="dt">int</span> ans=<span class="dv">0</span>;<span class="dt">int</span> last=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb12-120" title="120">    <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;cnt;i++){</a>
<a class="sourceLine" id="cb12-121" title="121">        update(segs[i].tag,segs[i].lef,segs[i].rig-<span class="dv">1</span>,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb12-122" title="122">        ans+=abs(ns[<span class="dv">1</span>].len-last);        <span class="co">//当前的ns[1].len包括上一次统计的区间长度,因此需要减去last </span></a>
<a class="sourceLine" id="cb12-123" title="123">        last=ns[<span class="dv">1</span>].len;</a>
<a class="sourceLine" id="cb12-124" title="124">        ans+=(segs[i+<span class="dv">1</span>].h-segs[i].h)*<span class="dv">2</span>*ns[<span class="dv">1</span>].num;        <span class="co">//ns[1]为当前扫描线下区间的线段数目 </span></a>
<a class="sourceLine" id="cb12-125" title="125">    }</a>
<a class="sourceLine" id="cb12-126" title="126">    cout&lt;&lt;ans&lt;&lt;endl;</a>
<a class="sourceLine" id="cb12-127" title="127">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb12-128" title="128">} </a></code></pre></div>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/HDU-1255">HDU1255 覆盖的面积</a></p>
<p>扫描线计算被覆盖两次及以上的覆盖面积。<span class="math inline">\(cover\_cnt\)</span>表示的是被完全覆盖的区间的长度。当一个区间被完全覆盖的次数大于等于2时，其二次覆盖长度就是其区间长度；当被完全覆盖的次数为1时，其二次覆盖长度为左儿子与右儿子的一次覆盖面积的和；若以上两种情况都不符合，那就由左儿子和右儿子的二次覆盖面积转移得到。</p>
<p>另外，这题需要离散化。</p>
<p>代码如下：</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb13-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="pp">#include </span><span class="im">&lt;utility&gt;</span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="pp">#include </span><span class="im">&lt;stack&gt;</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb13-16" title="16"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb13-17" title="17"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb13-20" title="20"><span class="pp">#define IOS </span><span class="bu">std::</span>ios<span class="bu">::</span>sync_with_stdio(<span class="kw">false</span>)</a>
<a class="sourceLine" id="cb13-21" title="21"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="dv">1005</span>;</a>
<a class="sourceLine" id="cb13-22" title="22"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb13-23" title="23"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb13-24" title="24"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb13-25" title="25"><span class="kw">struct</span> seg{</a>
<a class="sourceLine" id="cb13-26" title="26">    <span class="dt">double</span> lef,rig;</a>
<a class="sourceLine" id="cb13-27" title="27">    <span class="dt">double</span> hei;</a>
<a class="sourceLine" id="cb13-28" title="28">    <span class="dt">int</span> tag;</a>
<a class="sourceLine" id="cb13-29" title="29">    seg(){}</a>
<a class="sourceLine" id="cb13-30" title="30">    seg(<span class="dt">double</span> lef,<span class="dt">double</span> rig,<span class="dt">double</span> hei,<span class="dt">int</span> tag)</a>
<a class="sourceLine" id="cb13-31" title="31">        :lef(lef),rig(rig),hei(hei),tag(tag){}</a>
<a class="sourceLine" id="cb13-32" title="32">    <span class="dt">bool</span> <span class="kw">operator</span>&lt;(<span class="at">const</span> seg&amp; se) <span class="at">const</span>{</a>
<a class="sourceLine" id="cb13-33" title="33">        <span class="cf">return</span> hei&lt;se.hei;</a>
<a class="sourceLine" id="cb13-34" title="34">    }</a>
<a class="sourceLine" id="cb13-35" title="35">};</a>
<a class="sourceLine" id="cb13-36" title="36">seg segs[maxn&lt;&lt;<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb13-37" title="37"><span class="kw">struct</span> node{        <span class="co">//线段树节点,表示一个区间</span></a>
<a class="sourceLine" id="cb13-38" title="38">    <span class="dt">int</span> lef,rig;</a>
<a class="sourceLine" id="cb13-39" title="39">    <span class="dt">double</span> len,len2;</a>
<a class="sourceLine" id="cb13-40" title="40">    <span class="dt">int</span> cover_cnt;</a>
<a class="sourceLine" id="cb13-41" title="41">    node(){}</a>
<a class="sourceLine" id="cb13-42" title="42">    node(<span class="dt">int</span> lef,<span class="dt">int</span> rig)</a>
<a class="sourceLine" id="cb13-43" title="43">        :lef(lef),rig(rig){</a>
<a class="sourceLine" id="cb13-44" title="44">            len=<span class="dv">0</span>;cover_cnt=<span class="dv">0</span>;len2=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb13-45" title="45">        }</a>
<a class="sourceLine" id="cb13-46" title="46">};</a>
<a class="sourceLine" id="cb13-47" title="47">node ns[maxn&lt;&lt;<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb13-48" title="48"><span class="dt">double</span> xs[maxn&lt;&lt;<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb13-49" title="49"><span class="dt">void</span> build(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb13-50" title="50">{</a>
<a class="sourceLine" id="cb13-51" title="51">    ns[rt].lef=lef;ns[rt].rig=rig;</a>
<a class="sourceLine" id="cb13-52" title="52">    ns[rt].len=ns[rt].len2=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb13-53" title="53">    ns[rt].cover_cnt=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb13-54" title="54">    <span class="cf">if</span>(lef==rig)    <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb13-55" title="55">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb13-56" title="56">    build(lson);</a>
<a class="sourceLine" id="cb13-57" title="57">    build(rson);</a>
<a class="sourceLine" id="cb13-58" title="58">}</a>
<a class="sourceLine" id="cb13-59" title="59"><span class="dt">void</span> pushup(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb13-60" title="60">{</a>
<a class="sourceLine" id="cb13-61" title="61">    <span class="cf">if</span>(ns[rt].cover_cnt){</a>
<a class="sourceLine" id="cb13-62" title="62">        ns[rt].len=xs[ns[rt].rig+<span class="dv">1</span>]-xs[ns[rt].lef];</a>
<a class="sourceLine" id="cb13-63" title="63">    }<span class="cf">else</span> <span class="cf">if</span>(ns[rt].lef==ns[rt].rig){</a>
<a class="sourceLine" id="cb13-64" title="64">        ns[rt].len=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb13-65" title="65">    }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb13-66" title="66">        ns[rt].len=ns[rt&lt;&lt;<span class="dv">1</span>].len+ns[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].len;</a>
<a class="sourceLine" id="cb13-67" title="67">    }</a>
<a class="sourceLine" id="cb13-68" title="68">    <span class="cf">if</span>(ns[rt].cover_cnt&gt;=<span class="dv">2</span>){</a>
<a class="sourceLine" id="cb13-69" title="69">        ns[rt].len2=xs[ns[rt].rig+<span class="dv">1</span>]-xs[ns[rt].lef];</a>
<a class="sourceLine" id="cb13-70" title="70">    }<span class="cf">else</span> <span class="cf">if</span>(ns[rt].lef==ns[rt].rig){</a>
<a class="sourceLine" id="cb13-71" title="71">        ns[rt].len2=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb13-72" title="72">    }<span class="cf">else</span> <span class="cf">if</span>(ns[rt].cover_cnt==<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb13-73" title="73">        ns[rt].len2=ns[rt&lt;&lt;<span class="dv">1</span>].len+ns[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].len;</a>
<a class="sourceLine" id="cb13-74" title="74">    }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb13-75" title="75">        ns[rt].len2=ns[rt&lt;&lt;<span class="dv">1</span>].len2+ns[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].len2;</a>
<a class="sourceLine" id="cb13-76" title="76">    }</a>
<a class="sourceLine" id="cb13-77" title="77">}</a>
<a class="sourceLine" id="cb13-78" title="78"><span class="dt">void</span> update(<span class="dt">int</span> val,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb13-79" title="79">{</a>
<a class="sourceLine" id="cb13-80" title="80">    <span class="cf">if</span>(ns[rt].lef==lef&amp;&amp;ns[rt].rig==rig){</a>
<a class="sourceLine" id="cb13-81" title="81">        ns[rt].cover_cnt+=val;</a>
<a class="sourceLine" id="cb13-82" title="82">        pushup(rt);</a>
<a class="sourceLine" id="cb13-83" title="83">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb13-84" title="84">    }</a>
<a class="sourceLine" id="cb13-85" title="85">    <span class="dt">int</span> mid=(ns[rt].lef)+(ns[rt].rig-ns[rt].lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb13-86" title="86">    <span class="cf">if</span>(rig&lt;=mid){</a>
<a class="sourceLine" id="cb13-87" title="87">        update(val,lef,rig,rt&lt;&lt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb13-88" title="88">    }<span class="cf">else</span> <span class="cf">if</span>(lef&gt;mid){</a>
<a class="sourceLine" id="cb13-89" title="89">        update(val,lef,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb13-90" title="90">    }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb13-91" title="91">        update(val,lef,mid,rt&lt;&lt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb13-92" title="92">        update(val,mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb13-93" title="93">    }</a>
<a class="sourceLine" id="cb13-94" title="94">    pushup(rt);</a>
<a class="sourceLine" id="cb13-95" title="95">}</a>
<a class="sourceLine" id="cb13-96" title="96"><span class="dt">int</span> binary(<span class="dt">double</span> arr[],<span class="dt">double</span> key,<span class="dt">int</span> n)</a>
<a class="sourceLine" id="cb13-97" title="97">{</a>
<a class="sourceLine" id="cb13-98" title="98">    <span class="dt">int</span> lef=<span class="dv">0</span>;<span class="dt">int</span> rig=n-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb13-99" title="99">    <span class="cf">while</span>(lef&lt;=rig){</a>
<a class="sourceLine" id="cb13-100" title="100">        <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb13-101" title="101">        <span class="cf">if</span>(arr[mid]==key)</a>
<a class="sourceLine" id="cb13-102" title="102">            <span class="cf">return</span> mid;</a>
<a class="sourceLine" id="cb13-103" title="103">        <span class="cf">else</span> <span class="cf">if</span>(arr[mid]&lt;key)</a>
<a class="sourceLine" id="cb13-104" title="104">            lef=mid+<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb13-105" title="105">        <span class="cf">else</span></a>
<a class="sourceLine" id="cb13-106" title="106">            rig=mid-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb13-107" title="107">    }</a>
<a class="sourceLine" id="cb13-108" title="108">    <span class="cf">return</span> rig;</a>
<a class="sourceLine" id="cb13-109" title="109">}</a>
<a class="sourceLine" id="cb13-110" title="110"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb13-111" title="111">{</a>
<a class="sourceLine" id="cb13-112" title="112">    <span class="dt">int</span> t;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;t);</a>
<a class="sourceLine" id="cb13-113" title="113">    <span class="cf">while</span>(t--){</a>
<a class="sourceLine" id="cb13-114" title="114">        mst(xs,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb13-115" title="115">        <span class="dt">int</span> n;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;n);</a>
<a class="sourceLine" id="cb13-116" title="116">        <span class="dt">int</span> cnt=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb13-117" title="117">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n;i++){</a>
<a class="sourceLine" id="cb13-118" title="118">            <span class="dt">double</span> x1,y1,x2,y2;</a>
<a class="sourceLine" id="cb13-119" title="119">            scanf(<span class="st">"</span><span class="sc">%lf</span><span class="st"> </span><span class="sc">%lf</span><span class="st"> </span><span class="sc">%lf</span><span class="st"> </span><span class="sc">%lf</span><span class="st">"</span>,&amp;x1,&amp;y1,&amp;x2,&amp;y2);</a>
<a class="sourceLine" id="cb13-120" title="120">            segs[cnt]=seg(x1,x2,y1,<span class="dv">1</span>);       <span class="co">//下位</span></a>
<a class="sourceLine" id="cb13-121" title="121">            xs[cnt++]=x1;</a>
<a class="sourceLine" id="cb13-122" title="122">            segs[cnt]=seg(x1,x2,y2,-<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb13-123" title="123">            xs[cnt++]=x2;</a>
<a class="sourceLine" id="cb13-124" title="124">        }</a>
<a class="sourceLine" id="cb13-125" title="125">        sort(xs,xs+cnt);</a>
<a class="sourceLine" id="cb13-126" title="126"><span class="co">//        for(int i=0;i&lt;cnt;i++)</span></a>
<a class="sourceLine" id="cb13-127" title="127"><span class="co">//            cout&lt;&lt;xs[i]&lt;&lt;" ";</span></a>
<a class="sourceLine" id="cb13-128" title="128"><span class="co">//        cout&lt;&lt;"\n";</span></a>
<a class="sourceLine" id="cb13-129" title="129">        sort(segs,segs+cnt);</a>
<a class="sourceLine" id="cb13-130" title="130">        <span class="dt">int</span> idx=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb13-131" title="131">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">1</span>;i&lt;cnt;i++)</a>
<a class="sourceLine" id="cb13-132" title="132">            <span class="cf">if</span>(xs[i]!=xs[i-<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb13-133" title="133">                xs[idx++]=xs[i];</a>
<a class="sourceLine" id="cb13-134" title="134">        build(<span class="dv">0</span>,idx-<span class="dv">1</span>,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb13-135" title="135">        <span class="dt">double</span> ans=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb13-136" title="136">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;cnt-<span class="dv">1</span>;i++){</a>
<a class="sourceLine" id="cb13-137" title="137">            <span class="dt">int</span> lx=binary(xs,segs[i].lef,idx);</a>
<a class="sourceLine" id="cb13-138" title="138">            <span class="dt">int</span> rx=binary(xs,segs[i].rig,idx)-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb13-139" title="139">            update(segs[i].tag,lx,rx,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb13-140" title="140">            ans+=(segs[i+<span class="dv">1</span>].hei-segs[i].hei)*(ns[<span class="dv">1</span>].len2);</a>
<a class="sourceLine" id="cb13-141" title="141"><span class="co">//            printf("ans+: %.2lf\n",(segs[i+1].hei-segs[i].hei)*(ns[1].len2));</span></a>
<a class="sourceLine" id="cb13-142" title="142"><span class="co">//            printf("ns[1].len2: %.2lf\n",ns[1].len2);</span></a>
<a class="sourceLine" id="cb13-143" title="143"><span class="co">//            printf("segs[i+1].hei-segs[i].hei: %.2lf\n\n",segs[i+1].hei-segs[i].hei);</span></a>
<a class="sourceLine" id="cb13-144" title="144">        }</a>
<a class="sourceLine" id="cb13-145" title="145">        printf(<span class="st">"%.2lf</span><span class="sc">\n</span><span class="st">"</span>,ans);</a>
<a class="sourceLine" id="cb13-146" title="146">    }</a>
<a class="sourceLine" id="cb13-147" title="147">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb13-148" title="148">}</a></code></pre></div>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/HDU-1542">HDU1542 Atlantis</a></p>
<p>扫描线最经典的应用，求矩形的面积并。线段树维护区间的被覆盖长度，然后根据扫描线高度差计算面积即可。另外，本题需要离散化。 代码如下:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb14-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="pp">#include </span><span class="im">&lt;utility&gt;</span></a>
<a class="sourceLine" id="cb14-10" title="10"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="pp">#include </span><span class="im">&lt;stack&gt;</span></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></a>
<a class="sourceLine" id="cb14-13" title="13"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb14-14" title="14"><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb14-15" title="15"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(a))</a>
<a class="sourceLine" id="cb14-16" title="16"><span class="pp">#define debug </span>printf(<span class="st">"debug</span><span class="sc">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb14-17" title="17"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb14-18" title="18"><span class="pp">#define IOS </span><span class="bu">std::</span>ios<span class="bu">::</span>sync_with_stdio(<span class="kw">false</span>)</a>
<a class="sourceLine" id="cb14-19" title="19"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb14-20" title="20"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb14-21" title="21"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="dv">2005</span>;</a>
<a class="sourceLine" id="cb14-22" title="22"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb14-23" title="23"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb14-24" title="24"><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> ull;</a>
<a class="sourceLine" id="cb14-25" title="25"><span class="kw">struct</span> seg{</a>
<a class="sourceLine" id="cb14-26" title="26">    <span class="dt">double</span> lef;<span class="dt">double</span> rig;</a>
<a class="sourceLine" id="cb14-27" title="27">    <span class="dt">double</span> hei;<span class="dt">int</span> tag;</a>
<a class="sourceLine" id="cb14-28" title="28">    <span class="co">//tag=1表示下位边,tag=-1表示上位边</span></a>
<a class="sourceLine" id="cb14-29" title="29">    seg(){</a>
<a class="sourceLine" id="cb14-30" title="30">    } </a>
<a class="sourceLine" id="cb14-31" title="31">    seg(<span class="dt">double</span> lef,<span class="dt">double</span> rig,<span class="dt">double</span> hei,<span class="dt">int</span> tag)</a>
<a class="sourceLine" id="cb14-32" title="32">        :lef(lef),rig(rig),hei(hei),tag(tag){</a>
<a class="sourceLine" id="cb14-33" title="33">        } </a>
<a class="sourceLine" id="cb14-34" title="34">    <span class="dt">bool</span> <span class="kw">operator</span>&lt;(<span class="at">const</span> seg&amp; se) <span class="at">const</span>{</a>
<a class="sourceLine" id="cb14-35" title="35">        <span class="cf">return</span> hei&lt;se.hei;</a>
<a class="sourceLine" id="cb14-36" title="36">    }</a>
<a class="sourceLine" id="cb14-37" title="37">};</a>
<a class="sourceLine" id="cb14-38" title="38">seg segs[maxn];</a>
<a class="sourceLine" id="cb14-39" title="39"><span class="dt">double</span> X[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb14-40" title="40"><span class="dt">int</span> vis[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb14-41" title="41"><span class="dt">double</span> sum[maxn&lt;&lt;<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb14-42" title="42"><span class="dt">int</span> idx;</a>
<a class="sourceLine" id="cb14-43" title="43"><span class="dt">void</span> pushup(<span class="dt">int</span> l,<span class="dt">int</span> r,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb14-44" title="44">{</a>
<a class="sourceLine" id="cb14-45" title="45">    <span class="cf">if</span>(vis[rt])</a>
<a class="sourceLine" id="cb14-46" title="46">        sum[rt]=X[r+<span class="dv">1</span>]-X[l];</a>
<a class="sourceLine" id="cb14-47" title="47">    <span class="cf">else</span> <span class="cf">if</span>(l==r)</a>
<a class="sourceLine" id="cb14-48" title="48">        sum[rt]=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb14-49" title="49">    <span class="cf">else</span></a>
<a class="sourceLine" id="cb14-50" title="50">        sum[rt]=sum[rt&lt;&lt;<span class="dv">1</span>]+sum[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>]; </a>
<a class="sourceLine" id="cb14-51" title="51">}</a>
<a class="sourceLine" id="cb14-52" title="52"><span class="dt">void</span> update(<span class="dt">int</span> L,<span class="dt">int</span> R,<span class="dt">int</span> val,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb14-53" title="53">{</a>
<a class="sourceLine" id="cb14-54" title="54">    <span class="cf">if</span>(L&lt;=lef&amp;&amp;rig&lt;=R){</a>
<a class="sourceLine" id="cb14-55" title="55">        vis[rt]+=val;</a>
<a class="sourceLine" id="cb14-56" title="56">        pushup(lef,rig,rt);</a>
<a class="sourceLine" id="cb14-57" title="57">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb14-58" title="58">    }</a>
<a class="sourceLine" id="cb14-59" title="59">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb14-60" title="60">    <span class="cf">if</span>(L&lt;=mid)</a>
<a class="sourceLine" id="cb14-61" title="61">        update(L,R,val,lson);</a>
<a class="sourceLine" id="cb14-62" title="62">    <span class="cf">if</span>(R&gt;mid)</a>
<a class="sourceLine" id="cb14-63" title="63">        update(L,R,val,rson);</a>
<a class="sourceLine" id="cb14-64" title="64">    pushup(lef,rig,rt);</a>
<a class="sourceLine" id="cb14-65" title="65">}</a>
<a class="sourceLine" id="cb14-66" title="66"><span class="dt">int</span> binary(<span class="dt">double</span> todo)</a>
<a class="sourceLine" id="cb14-67" title="67">{</a>
<a class="sourceLine" id="cb14-68" title="68">    <span class="dt">int</span> Lef,Rig;</a>
<a class="sourceLine" id="cb14-69" title="69">    Lef=<span class="dv">0</span>;Rig=idx-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb14-70" title="70">    <span class="cf">while</span>(Lef&lt;=Rig){</a>
<a class="sourceLine" id="cb14-71" title="71">        <span class="dt">int</span> mid=Lef+(Rig-Lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb14-72" title="72">        <span class="cf">if</span>(X[mid]&gt;todo)</a>
<a class="sourceLine" id="cb14-73" title="73">            Rig=mid-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb14-74" title="74">        <span class="cf">else</span></a>
<a class="sourceLine" id="cb14-75" title="75">            Lef=mid+<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb14-76" title="76">    }</a>
<a class="sourceLine" id="cb14-77" title="77">    <span class="cf">return</span> Rig;</a>
<a class="sourceLine" id="cb14-78" title="78">}</a>
<a class="sourceLine" id="cb14-79" title="79"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb14-80" title="80">{</a>
<a class="sourceLine" id="cb14-81" title="81">    <span class="dt">int</span> n;<span class="dt">int</span> kase=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb14-82" title="82">    <span class="cf">while</span>(cin&gt;&gt;n&amp;&amp;n){</a>
<a class="sourceLine" id="cb14-83" title="83">        <span class="dt">int</span> cnt=<span class="dv">0</span>;idx=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb14-84" title="84">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n;i++){</a>
<a class="sourceLine" id="cb14-85" title="85">            <span class="dt">double</span> x1,y1,x2,y2;</a>
<a class="sourceLine" id="cb14-86" title="86">            scanf(<span class="st">"</span><span class="sc">%lf</span><span class="st"> </span><span class="sc">%lf</span><span class="st"> </span><span class="sc">%lf</span><span class="st"> </span><span class="sc">%lf</span><span class="st">"</span>,&amp;x1,&amp;y1,&amp;x2,&amp;y2); </a>
<a class="sourceLine" id="cb14-87" title="87">            segs[cnt]=seg(x1,x2,y1,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb14-88" title="88">            X[cnt++]=x1;</a>
<a class="sourceLine" id="cb14-89" title="89">            segs[cnt]=seg(x1,x2,y2,-<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb14-90" title="90">            X[cnt++]=x2;</a>
<a class="sourceLine" id="cb14-91" title="91">        }</a>
<a class="sourceLine" id="cb14-92" title="92">        sort(segs,segs+cnt);</a>
<a class="sourceLine" id="cb14-93" title="93">        sort(X,X+cnt);</a>
<a class="sourceLine" id="cb14-94" title="94">        idx=<span class="dv">1</span>;<span class="dt">double</span> ans=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb14-95" title="95">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">1</span>;i&lt;cnt;i++)</a>
<a class="sourceLine" id="cb14-96" title="96">            <span class="cf">if</span>(X[i]!=X[i-<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb14-97" title="97">                X[idx++]=X[i];</a>
<a class="sourceLine" id="cb14-98" title="98">        mst(sum,<span class="dv">0</span>);mst(vis,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb14-99" title="99">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;cnt-<span class="dv">1</span>;i++){</a>
<a class="sourceLine" id="cb14-100" title="100">            <span class="dt">int</span> L=binary(segs[i].lef);</a>
<a class="sourceLine" id="cb14-101" title="101">            <span class="dt">int</span> R=binary(segs[i].rig)-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb14-102" title="102">            update(L,R,segs[i].tag,<span class="dv">0</span>,idx-<span class="dv">1</span>,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb14-103" title="103">            ans+=sum[<span class="dv">1</span>]*(segs[i+<span class="dv">1</span>].hei-segs[i].hei);</a>
<a class="sourceLine" id="cb14-104" title="104">        }</a>
<a class="sourceLine" id="cb14-105" title="105">        printf(<span class="st">"Test case #</span><span class="sc">%d\n</span><span class="st">"</span>,++kase);</a>
<a class="sourceLine" id="cb14-106" title="106">        printf(<span class="st">"Total explored area: %.2lf</span><span class="sc">\n\n</span><span class="st">"</span>,ans);</a>
<a class="sourceLine" id="cb14-107" title="107">    }</a>
<a class="sourceLine" id="cb14-108" title="108">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb14-109" title="109">} </a></code></pre></div>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cn.vjudge.net/problem/HDU-3642">HDU3642 Get the Treasury</a> 题意是求在三维空间中，有若干个矩形区域，求重叠次数大于等于3的区域的体积。 思路是用线段树维护单个平面被覆盖次数大于等于3的平面区域的面积，然后枚举z轴上的高度差，进而算出面积（z的范围并不大，可以枚举） 具体见代码</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb15-1" title="1"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="pp">#include </span><span class="im">&lt;cstdlib&gt;</span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="pp">#include </span><span class="im">&lt;string&gt;</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></a>
<a class="sourceLine" id="cb15-8" title="8"><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="pp">#include </span><span class="im">&lt;list&gt;</span></a>
<a class="sourceLine" id="cb15-10" title="10"><span class="pp">#include </span><span class="im">&lt;stack&gt;</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="pp">#include </span><span class="im">&lt;set&gt;</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="pp">#include </span><span class="im">&lt;map&gt;</span></a>
<a class="sourceLine" id="cb15-13" title="13"><span class="pp">#define INF </span><span class="bn">0x3f3f3f3f</span></a>
<a class="sourceLine" id="cb15-14" title="14"><span class="pp">#define mst</span>(a,b)<span class="pp"> </span>memset((a),(b),<span class="kw">sizeof</span>(b))</a>
<a class="sourceLine" id="cb15-15" title="15"><span class="pp">#define debug </span>cout&lt;&lt;<span class="st">"debug"</span>&lt;&lt;endl;</a>
<a class="sourceLine" id="cb15-16" title="16"><span class="pp">#define lson </span>lef,mid,rt&lt;&lt;<span class="dv">1</span></a>
<a class="sourceLine" id="cb15-17" title="17"><span class="pp">#define rson </span>mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span></a>
<a class="sourceLine" id="cb15-18" title="18"><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll;</a>
<a class="sourceLine" id="cb15-19" title="19"><span class="at">const</span> <span class="dt">int</span> maxn=<span class="dv">2500</span>;</a>
<a class="sourceLine" id="cb15-20" title="20"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb15-21" title="21"><span class="kw">struct</span> seg{</a>
<a class="sourceLine" id="cb15-22" title="22">    <span class="dt">int</span> lef,rig;</a>
<a class="sourceLine" id="cb15-23" title="23">    <span class="dt">int</span> hei;</a>
<a class="sourceLine" id="cb15-24" title="24">    <span class="dt">int</span> tag;</a>
<a class="sourceLine" id="cb15-25" title="25">    seg(){}</a>
<a class="sourceLine" id="cb15-26" title="26">    seg(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> hei,<span class="dt">int</span> tag)</a>
<a class="sourceLine" id="cb15-27" title="27">        :lef(lef),rig(rig),hei(hei),tag(tag){}</a>
<a class="sourceLine" id="cb15-28" title="28">    <span class="dt">void</span> set(<span class="dt">int</span> l,<span class="dt">int</span> r,<span class="dt">int</span> h,<span class="dt">int</span> tt){</a>
<a class="sourceLine" id="cb15-29" title="29">        lef=l;rig=r;hei=h;</a>
<a class="sourceLine" id="cb15-30" title="30">        tag=tt;</a>
<a class="sourceLine" id="cb15-31" title="31">    }</a>
<a class="sourceLine" id="cb15-32" title="32">    <span class="dt">bool</span> <span class="kw">operator</span>&lt;(<span class="at">const</span> seg&amp; se)<span class="at">const</span>{</a>
<a class="sourceLine" id="cb15-33" title="33">        <span class="cf">return</span> hei&lt;se.hei;</a>
<a class="sourceLine" id="cb15-34" title="34">    }</a>
<a class="sourceLine" id="cb15-35" title="35">};</a>
<a class="sourceLine" id="cb15-36" title="36"><span class="kw">struct</span> node{</a>
<a class="sourceLine" id="cb15-37" title="37">    <span class="dt">int</span> lef,rig;</a>
<a class="sourceLine" id="cb15-38" title="38">    <span class="dt">int</span> len,len2,len3;    </a>
<a class="sourceLine" id="cb15-39" title="39">    <span class="dt">int</span> cover_cnt;</a>
<a class="sourceLine" id="cb15-40" title="40">    node(){}</a>
<a class="sourceLine" id="cb15-41" title="41"><span class="co">//    node(int lef,int rig)</span></a>
<a class="sourceLine" id="cb15-42" title="42"><span class="co">//        :lef(lef),rig(rig){len=len2=len3=cover_cnt=0;}</span></a>
<a class="sourceLine" id="cb15-43" title="43">};</a>
<a class="sourceLine" id="cb15-44" title="44"><span class="kw">struct</span> point{</a>
<a class="sourceLine" id="cb15-45" title="45">    <span class="dt">int</span> x,y,z;</a>
<a class="sourceLine" id="cb15-46" title="46">    point(<span class="dt">int</span> x,<span class="dt">int</span> y,<span class="dt">int</span> z)</a>
<a class="sourceLine" id="cb15-47" title="47">        :x(x),y(y),z(z){}</a>
<a class="sourceLine" id="cb15-48" title="48">    point(){}</a>
<a class="sourceLine" id="cb15-49" title="49">};</a>
<a class="sourceLine" id="cb15-50" title="50">node tree[maxn&lt;&lt;<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb15-51" title="51">point ps[maxn&lt;&lt;<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb15-52" title="52"><span class="dt">int</span> xs[maxn&lt;&lt;<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb15-53" title="53"><span class="dt">int</span> zs[maxn&lt;&lt;<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb15-54" title="54">seg segs[maxn&lt;&lt;<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb15-55" title="55"><span class="dt">void</span> build(<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb15-56" title="56">{</a>
<a class="sourceLine" id="cb15-57" title="57">    tree[rt].lef=lef;tree[rt].rig=rig;</a>
<a class="sourceLine" id="cb15-58" title="58">    tree[rt].len=tree[rt].len2=tree[rt].len3=tree[rt].cover_cnt=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb15-59" title="59">    <span class="cf">if</span>(lef==rig)</a>
<a class="sourceLine" id="cb15-60" title="60">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb15-61" title="61">    <span class="dt">int</span> mid=lef+(rig-lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb15-62" title="62">    build(lson);</a>
<a class="sourceLine" id="cb15-63" title="63">    build(rson);</a>
<a class="sourceLine" id="cb15-64" title="64">}</a>
<a class="sourceLine" id="cb15-65" title="65"><span class="dt">void</span> pushup(<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb15-66" title="66">{</a>
<a class="sourceLine" id="cb15-67" title="67">    <span class="cf">if</span>(tree[rt].cover_cnt&gt;=<span class="dv">3</span>){</a>
<a class="sourceLine" id="cb15-68" title="68">        tree[rt].len3=xs[tree[rt].rig+<span class="dv">1</span>]-xs[tree[rt].lef];</a>
<a class="sourceLine" id="cb15-69" title="69">        tree[rt].len2=tree[rt].len=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb15-70" title="70">    }<span class="cf">else</span> <span class="cf">if</span>(tree[rt].cover_cnt&gt;=<span class="dv">2</span>){</a>
<a class="sourceLine" id="cb15-71" title="71">        tree[rt].len3=tree[rt&lt;&lt;<span class="dv">1</span>].len3+tree[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].len3+tree[rt&lt;&lt;<span class="dv">1</span>].len2+tree[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].len2+tree[rt&lt;&lt;<span class="dv">1</span>].len+tree[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].len;</a>
<a class="sourceLine" id="cb15-72" title="72">        tree[rt].len2=xs[tree[rt].rig+<span class="dv">1</span>]-xs[tree[rt].lef]-tree[rt].len3;</a>
<a class="sourceLine" id="cb15-73" title="73">        tree[rt].len=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb15-74" title="74">    }<span class="cf">else</span> <span class="cf">if</span>(tree[rt].cover_cnt&gt;=<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb15-75" title="75">        tree[rt].len3=tree[rt&lt;&lt;<span class="dv">1</span>].len3+tree[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].len3+tree[rt&lt;&lt;<span class="dv">1</span>].len2+tree[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].len2;</a>
<a class="sourceLine" id="cb15-76" title="76">        tree[rt].len2=tree[rt&lt;&lt;<span class="dv">1</span>].len+tree[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].len;</a>
<a class="sourceLine" id="cb15-77" title="77">        tree[rt].len=xs[tree[rt].rig+<span class="dv">1</span>]-xs[tree[rt].lef]-tree[rt].len2-tree[rt].len3;</a>
<a class="sourceLine" id="cb15-78" title="78">    }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb15-79" title="79">        tree[rt].len3=tree[rt&lt;&lt;<span class="dv">1</span>].len3+tree[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].len3;</a>
<a class="sourceLine" id="cb15-80" title="80">        tree[rt].len2=tree[rt&lt;&lt;<span class="dv">1</span>].len2+tree[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].len2;</a>
<a class="sourceLine" id="cb15-81" title="81">        tree[rt].len=tree[rt&lt;&lt;<span class="dv">1</span>].len+tree[rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>].len;</a>
<a class="sourceLine" id="cb15-82" title="82">    }</a>
<a class="sourceLine" id="cb15-83" title="83">}</a>
<a class="sourceLine" id="cb15-84" title="84"><span class="dt">void</span> update(<span class="dt">int</span> val,<span class="dt">int</span> lef,<span class="dt">int</span> rig,<span class="dt">int</span> rt)</a>
<a class="sourceLine" id="cb15-85" title="85">{</a>
<a class="sourceLine" id="cb15-86" title="86">    <span class="cf">if</span>(lef==tree[rt].lef&amp;&amp;rig==tree[rt].rig){</a>
<a class="sourceLine" id="cb15-87" title="87">        tree[rt].cover_cnt+=val;</a>
<a class="sourceLine" id="cb15-88" title="88">        pushup(rt);</a>
<a class="sourceLine" id="cb15-89" title="89">        <span class="cf">return</span> ;</a>
<a class="sourceLine" id="cb15-90" title="90">    }</a>
<a class="sourceLine" id="cb15-91" title="91">    <span class="dt">int</span> mid=(tree[rt].lef)+(tree[rt].rig-tree[rt].lef)/<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb15-92" title="92">    <span class="cf">if</span>(rig&lt;=mid){</a>
<a class="sourceLine" id="cb15-93" title="93">        update(val,lef,rig,rt&lt;&lt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb15-94" title="94">    }<span class="cf">else</span> <span class="cf">if</span>(lef&gt;mid){</a>
<a class="sourceLine" id="cb15-95" title="95">        update(val,lef,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb15-96" title="96">    }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb15-97" title="97">        update(val,lef,mid,rt&lt;&lt;<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb15-98" title="98">        update(val,mid+<span class="dv">1</span>,rig,rt&lt;&lt;<span class="dv">1</span>|<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb15-99" title="99">    }</a>
<a class="sourceLine" id="cb15-100" title="100">    pushup(rt);</a>
<a class="sourceLine" id="cb15-101" title="101">}</a>
<a class="sourceLine" id="cb15-102" title="102"><span class="dt">void</span> init(<span class="dt">int</span> n)</a>
<a class="sourceLine" id="cb15-103" title="103">{</a>
<a class="sourceLine" id="cb15-104" title="104">    <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n+<span class="dv">1</span>;i++){</a>
<a class="sourceLine" id="cb15-105" title="105">        tree[i].cover_cnt=tree[i].lef=tree[i].rig=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb15-106" title="106">        tree[i].len=tree[i].len2=tree[i].len3=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb15-107" title="107">    }</a>
<a class="sourceLine" id="cb15-108" title="108">}</a>
<a class="sourceLine" id="cb15-109" title="109"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb15-110" title="110">{</a>
<a class="sourceLine" id="cb15-111" title="111">    <span class="dt">int</span> t;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;t);</a>
<a class="sourceLine" id="cb15-112" title="112">    <span class="dt">int</span> kase=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb15-113" title="113">    <span class="cf">while</span>(t--){</a>
<a class="sourceLine" id="cb15-114" title="114">        init(<span class="dv">2005</span>);</a>
<a class="sourceLine" id="cb15-115" title="115">        mst(xs,<span class="dv">0</span>);mst(zs,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb15-116" title="116">        <span class="dt">int</span> n;scanf(<span class="st">"</span><span class="sc">%d</span><span class="st">"</span>,&amp;n);</a>
<a class="sourceLine" id="cb15-117" title="117">        <span class="dt">int</span> cnt=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb15-118" title="118">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n;i++){</a>
<a class="sourceLine" id="cb15-119" title="119">            <span class="dt">int</span> x1,y1,z1;</a>
<a class="sourceLine" id="cb15-120" title="120">            <span class="dt">int</span> x2,y2,z2;</a>
<a class="sourceLine" id="cb15-121" title="121">            scanf(<span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span>,&amp;x1,&amp;y1,&amp;z1,&amp;x2,&amp;y2,&amp;z2);</a>
<a class="sourceLine" id="cb15-122" title="122">            xs[cnt]=x1;xs[cnt+<span class="dv">1</span>]=x2;</a>
<a class="sourceLine" id="cb15-123" title="123">            zs[cnt]=z1;zs[cnt+<span class="dv">1</span>]=z2;</a>
<a class="sourceLine" id="cb15-124" title="124">            ps[cnt]=point(x1,y1,z1);ps[cnt+<span class="dv">1</span>]=point(x2,y2,z2);</a>
<a class="sourceLine" id="cb15-125" title="125">            cnt+=<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb15-126" title="126">        }</a>
<a class="sourceLine" id="cb15-127" title="127">        sort(xs,xs+cnt);</a>
<a class="sourceLine" id="cb15-128" title="128">        sort(zs,zs+cnt);</a>
<a class="sourceLine" id="cb15-129" title="129">        <span class="dt">int</span> idx=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb15-130" title="130">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">1</span>;i&lt;cnt;i++)</a>
<a class="sourceLine" id="cb15-131" title="131">            <span class="cf">if</span>(xs[i]!=xs[i-<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb15-132" title="132">                xs[idx++]=xs[i];</a>
<a class="sourceLine" id="cb15-133" title="133">        <span class="dt">int</span> idx1=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb15-134" title="134">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">1</span>;i&lt;cnt;i++)</a>
<a class="sourceLine" id="cb15-135" title="135">            <span class="cf">if</span>(zs[i]!=zs[i-<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb15-136" title="136">                zs[idx1++]=zs[i];</a>
<a class="sourceLine" id="cb15-137" title="137">        ll ans=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb15-138" title="138">        <span class="cf">for</span>(<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;idx1-<span class="dv">1</span>;i++){</a>
<a class="sourceLine" id="cb15-139" title="139">            <span class="dt">int</span> k=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb15-140" title="140">            <span class="cf">for</span>(<span class="dt">int</span> j=<span class="dv">0</span>;j&lt;cnt;j+=<span class="dv">2</span>){</a>
<a class="sourceLine" id="cb15-141" title="141">                <span class="cf">if</span>(ps[j].z&lt;=zs[i]&amp;&amp;ps[j+<span class="dv">1</span>].z&gt;zs[i]){</a>
<a class="sourceLine" id="cb15-142" title="142">                    segs[k++].set(ps[j].x,ps[j+<span class="dv">1</span>].x,ps[j].y,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb15-143" title="143">                    segs[k++].set(ps[j].x,ps[j+<span class="dv">1</span>].x,ps[j+<span class="dv">1</span>].y,-<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb15-144" title="144">                    <span class="co">// segs[k++]=seg(ps[j].x,ps[j+1].x,ps[j].y,1);</span></a>
<a class="sourceLine" id="cb15-145" title="145">                    <span class="co">// segs[k++]=seg(ps[j].x,ps[j+1].x,ps[j+1].y,-1);</span></a>
<a class="sourceLine" id="cb15-146" title="146">                }</a>
<a class="sourceLine" id="cb15-147" title="147">            }</a>
<a class="sourceLine" id="cb15-148" title="148">            init(idx-<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb15-149" title="149">            sort(segs,segs+k);</a>
<a class="sourceLine" id="cb15-150" title="150">            build(<span class="dv">0</span>,idx-<span class="dv">1</span>,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb15-151" title="151">            ll tmp=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb15-152" title="152">            <span class="cf">for</span>(<span class="dt">int</span> j=<span class="dv">0</span>;j&lt;k-<span class="dv">1</span>;j++){</a>
<a class="sourceLine" id="cb15-153" title="153">                <span class="dt">int</span> lx=lower_bound(xs,xs+idx,segs[j].lef)-xs;</a>
<a class="sourceLine" id="cb15-154" title="154">                <span class="dt">int</span> rx=lower_bound(xs,xs+idx,segs[j].rig)-xs-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb15-155" title="155">                update(segs[j].tag,lx,rx,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb15-156" title="156">                tmp+=(ll)tree[<span class="dv">1</span>].len3*(ll)(segs[j+<span class="dv">1</span>].hei-segs[j].hei);</a>
<a class="sourceLine" id="cb15-157" title="157">            }</a>
<a class="sourceLine" id="cb15-158" title="158">            ans+=(ll)tmp*(ll)(zs[i+<span class="dv">1</span>]-zs[i]);</a>
<a class="sourceLine" id="cb15-159" title="159">        }</a>
<a class="sourceLine" id="cb15-160" title="160">        <span class="cf">if</span>(n&lt;<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb15-161" title="161">            ans=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb15-162" title="162">        printf(<span class="st">"Case </span><span class="sc">%d</span><span class="st">: </span><span class="sc">%lld\n</span><span class="st">"</span>,++kase,ans);</a>
<a class="sourceLine" id="cb15-163" title="163">    }</a>
<a class="sourceLine" id="cb15-164" title="164">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb15-165" title="165">}</a>
<a class="sourceLine" id="cb15-166" title="166"><span class="co">/*</span></a>
<a class="sourceLine" id="cb15-167" title="167"><span class="co">4</span></a>
<a class="sourceLine" id="cb15-168" title="168"><span class="co">4 5 0 8 9 5</span></a>
<a class="sourceLine" id="cb15-169" title="169"><span class="co">0 3 3 4 5 7</span></a>
<a class="sourceLine" id="cb15-170" title="170"><span class="co">5 4 4 10 6 9</span></a>
<a class="sourceLine" id="cb15-171" title="171"><span class="co">5 5 5 9 9 7</span></a>
<a class="sourceLine" id="cb15-172" title="172"><span class="co">*/</span></a></code></pre></div>
<h3 id="后记">后记</h3>
<p>看了一下，虽然专题里面有区间合并的题目，但我并不是用正统的区间合并的方法做的啊......所以说这方面还需要再好好学一下呢。</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2019/08/16/Knapsack-Cryptosystem/" title="Knapsack Cryptosystem（2019牛客多校第9场  D题）"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: Knapsack Cryptosystem（2019牛客多校第9场  D题）</span></a><a class="button is-default" href="/2019/08/07/POJ-1330-Nearest-Common-Ancestors-Tarjan%E6%B1%82LCA%E6%A8%A1%E6%9D%BF/" title="POJ - 1330 Nearest Common Ancestors (Tarjan求LCA模板)"><span class="has-text-weight-semibold">Next: POJ - 1330 Nearest Common Ancestors (Tarjan求LCA模板)</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Haojen/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com//"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/haojen"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com//"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com//"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright ©</span><span> NeoRuTayE 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>